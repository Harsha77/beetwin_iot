import{r as m,j as C,c as f,C as i,D as d,G as e,K as g,N as r,W as y,Z as _,q as te,F as H,V as A,bG as q}from"./@vue-6KHaxNJ6.js";import{_ as E}from"./Download-Chzou-sw.js";import{u as se}from"./vue-router-CPl752RW.js";import{a as X}from"./axios-C_yEy3-Q.js";import{s as $}from"./index-F0Bpdt1j.js";import{c as oe}from"./frappe-ui-CIwioayB.js";import"./echarts-CbA4AjIf.js";import"./socket.io-client-o9UT993-.js";import{u as v,w as F}from"./xlsx-DAQG1NUx.js";import"./leaflet-CDkOlCyp.js";import"./feather-icons-09G7fcws.js";import"./@tiptap-BhO_3mwo.js";import"./prosemirror-dropcursor-DdDve3OF.js";import"./prosemirror-state-C0OblyT9.js";import"./prosemirror-model-CDAhqB4x.js";import"./orderedmap-C4TimWWB.js";import"./prosemirror-transform-DiPrUp-3.js";import"./prosemirror-gapcursor-B9ns80ZN.js";import"./prosemirror-keymap-BJ3QP8hu.js";import"./w3c-keyname-SJlxdkTY.js";import"./prosemirror-view-Dw0L6lI7.js";import"./prosemirror-history-4Kh61WTt.js";import"./rope-sequence-Cxv9J64N.js";import"./prosemirror-tables-Cnk26J7e.js";import"./linkifyjs-85EWwGDS.js";import"./prosemirror-commands-CZrlb0Rg.js";import"./prosemirror-schema-list-CPI4UhYk.js";import"./showdown-4mCZrU_9.js";import"./dayjs-CfxXAJTb.js";import"./idb-keyval-BeXAubRj.js";import"./@vueuse-moBmYcJ4.js";import"./reka-ui-jlgPPgUe.js";import"./@floating-ui-CoOhG2Tb.js";import"./vue-puX4Qeud.js";import"./tippy.js-BfW9tSbp.js";import"./@popperjs-DEdMZ52H.js";import"./@headlessui-C4-e1rF0.js";import"./lowlight-CuXNySGc.js";import"./highlight.js-kvRu1DFi.js";import"./tslib-BDyQ-Jie.js";import"./zrender-B8kCopLz.js";import"./engine.io-client-DoYcFuH8.js";import"./engine.io-parser-QVnBb3PJ.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-4mvwibnP.js";const re="/assets/beetwin_iot/iotweet-dashboard/IOtweet%20Logo_2.0%20white.png",ae="/assets/beetwin_iot/iotweet-dashboard/Dashboard_Icon.png",le="/assets/beetwin_iot/iotweet-dashboard/Diagnostic.png",ne={class:"min-h-screen flex flex-col"},ie={class:"fixed top-0 left-0 w-full flex items-center justify-between py-4 border-b bg-[#08444c] shadow px-5 z-50"},de={class:"bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold"},ue=["src"],pe={key:0,class:"absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-20"},ce={class:"block px-4 py-2 text-gray-700 font-semibold break-all"},me={key:1,class:"fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50"},ge={class:"bg-white p-6 rounded-md w-96"},be={key:0,class:"text-red-500 mt-2"},he={key:1,class:"text-green-500 mt-2"},we={class:"flex-grow flex flex-col md:flex-row"},ye={class:"space-y-4 text-lg font-semibold"},ve={key:0,class:"flex-grow p-6 pt-16"},xe={class:"flex justify-between items-center p-4"},De={class:"flex items-center gap-2"},fe={class:"mt-4"},_e={class:"table-auto w-full border-collapse border border-gray-300"},Pe={key:0},Se=["onClick"],ke={class:"border border-gray-300 px-4 py-2"},Ne={class:"border border-gray-300 px-4 py-2"},Ce={class:"border border-gray-300 px-4 py-2"},Ie={class:"border border-gray-300 px-4 py-2"},Te={class:"border border-gray-300 px-4 py-2"},Re={class:"border border-gray-300 px-4 py-2"},Le={class:"border border-gray-300 px-4 py-2"},Me={class:"border border-gray-300 px-4 py-2"},Ue={class:"border border-gray-300 px-4 py-2"},Oe={class:"flex justify-between items-center mt-4"},je=["disabled"],Ve=["disabled"],Be={key:1,class:"flex-grow p-6 pt-16"},He={class:"flex justify-between items-center p-4"},Ae={class:"flex items-center gap-2"},qe={class:"mt-4"},Ee={class:"table-auto w-full border-collapse border border-gray-300"},Xe={key:0},$e=["onClick"],Fe={class:"border border-gray-300 px-4 py-2"},Ge={class:"border border-gray-300 px-4 py-2"},Qe={class:"border border-gray-300 px-4 py-2"},ze={class:"border border-gray-300 px-4 py-2"},We={class:"border border-gray-300 px-4 py-2"},Ke={class:"border border-gray-300 px-4 py-2"},Ze={class:"border border-gray-300 px-4 py-2"},Je={class:"border border-gray-300 px-4 py-2"},Ye={class:"border border-gray-300 px-4 py-2"},et={class:"flex justify-between items-center mt-4"},tt=["disabled"],st=["disabled"],ot={data(){return{selectedTab:2,isSidebarOpen:!0,isDropdownOpen:!1,showModal:!1,searchQuery:"",rowsPerPage:10,currentPage:1,totalPages:1,currentUser:"",userImage:"/User.png",deviceList:[],diagnosticDeviceList:[],currentPassword:"",newPassword:"",confirmPassword:"",errorMessage:"",successMessage:""}},computed:{paginatedDevices(){let u=this.deviceList.filter(P=>{var b;return(b=P.serialNumber)==null?void 0:b.toLowerCase().includes(this.searchQuery.toLowerCase())});this.totalPages=Math.ceil(u.length/this.rowsPerPage);const l=(this.currentPage-1)*this.rowsPerPage;return u.slice(l,l+this.rowsPerPage)},paginatedDiagnosticDevices(){let u=this.diagnosticDeviceList.filter(P=>{var b;return(b=P.serialNumber)==null?void 0:b.toLowerCase().includes(this.searchQuery.toLowerCase())});this.totalPages=Math.ceil(u.length/this.rowsPerPage);const l=(this.currentPage-1)*this.rowsPerPage;return u.slice(l,l+this.rowsPerPage)}},methods:{toggleSidebar(){this.isSidebarOpen=!this.isSidebarOpen},toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen},setDashboardTab(){window.__homeState.selectedTab.value=2,window.__homeState.fetchDevices()},setDiagnosticTab(){window.__homeState.selectedTab.value=1,window.__homeState.fetchDiagnosticDevices()},fetchDashboardData(){},fetchDiagnosticData(){},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},downloaddiagnosticReport(){window.__homeState.downloaddiagnosticReport()},downloadReport(){window.__homeState.downloadReport()},navigateToDevice(u,l){window.__homeState.navigateToDevice(u,l)},navigateToDiagnosticDevice(u,l){window.__homeState.navigateToDiagnosticDevice(u,l)},logout(){window.__homeState.logout()},showAccountInfo(){this.showModal=!0},changePassword(){}},mounted(){this.fetchDashboardData()}},Wt=Object.assign(ot,{__name:"Home",setup(u){const l=m("/User.png"),{data:P}=oe({url:"/api/method/frappe.auth.get_logged_user",auto:!0,onSuccess:async s=>{if(s){const t=await b(s.message),o=(t==null?void 0:t.user_image)||G()||"/User.png";l.value=o,window.user_image_path=o,console.log("Image Path:",o)}}}),b=async s=>{},G=()=>{const s=document.cookie.match(/user_image=([^;]+)/);return s?decodeURIComponent(s[1]):null};C(()=>{window.user_image_path&&(l.value=window.user_image_path)});const Q=s=>{const o=document.cookie.split("; ").find(c=>c.startsWith(s+"="));return o?decodeURIComponent(o.split("=")[1]):null};C(()=>{const s=Q("user_image");s&&(l.value=`/api/method/frappe.utils.print_format.download_pdf?file_url=${s}`)});const I=se(),h=m([]),x=m([]),w=m(""),p=m(10),n=m(1),T=()=>{if(h.value.length===0){alert("No data to export.");return}const t=[...h.value].sort((a,N)=>a.serialNumber.localeCompare(N.serialNumber)).map(a=>({"Serial Number":a.serialNumber,"Device ID":a.deviceId,Timestamp:a.timestamp,"Pressure (bar)":a.latestData.pv,"Battery (%)":a.latestData.bt,"Sensor Health":a.latestData.ht==="0"?"Open":"Healthy",Latitude:a.latestData.lat,Longitude:a.latestData.long,"Signal Strength":a.latestData.rssi})),o=v.json_to_sheet(t),c=v.book_new();v.book_append_sheet(c,o,"BTX-PP Data"),F(c,"BTX-PP Data.xlsx")},R=()=>{if(h.value.length===0){alert("No data to export.");return}const t=[...x.value].sort((a,N)=>a.serialNumber.localeCompare(N.serialNumber)).map(a=>({"Serial Number":a.serialNumber,"Device ID":a.deviceId,Timestamp:a.timestamp,"Retry Count":a.latestDiagnosticData.rc,"Device Reset Status":a.latestDiagnosticData.rst==="1"?"Reset":"Not Reset","Sensor Health":a.latestDiagnosticData.ht==="0"?"Open":"Healthy","Mqtt Server Status":a.latestDiagnosticData.ms==="0"?"Data Not Sent":"Data Sent","Device Software Version":a.latestDiagnosticData.sv,"Signal Strength":a.latestDiagnosticData.rssi})),o=v.json_to_sheet(t),c=v.book_new();v.book_append_sheet(c,o,"BTX-PP Diagnostic Data"),F(c,"BTX-PP Diagnostic Data.xlsx")},S=m(2),z=()=>{S.value=2},k=m(!1),W=()=>{k.value=!k.value};function L(){$.logout.submit(),k.value=!1}const K=m($.user||"Guest"),Z=f(()=>h.value.filter(s=>s.serialNumber.toString().includes(w.value.trim())).sort((s,t)=>s.serialNumber.localeCompare(t.serialNumber))),J=f(()=>x.value.filter(s=>s.serialNumber.toString().includes(w.value.trim())).sort((s,t)=>s.serialNumber.localeCompare(t.serialNumber))),Y=f(()=>{const s=(n.value-1)*p.value;return Z.value.slice(s,s+p.value)}),ee=f(()=>{const s=(n.value-1)*p.value;return J.value.slice(s,s+p.value)}),D=f(()=>Math.ceil(h.value.length/p.value)),M=async()=>{try{const s=await X.get("/api/method/beetwin_iot.beetwin_iot.api.get_latest_device_data_for_Production.get_filtered_device_data_for_production");s.data.message.status==="success"&&(h.value=s.data.message.data.map(t=>({deviceId:t["Device ID"],serialNumber:t["Serial Number"],timestamp:t.Timestamp.slice(0,16),latestData:{pv:t["Pressure (bar)"],bt:t["Battery (%)"],ht:t["Sensor Health"],lat:t.Latitude,long:t.Longitude,rssi:t["RSSI Value"]}})))}catch(s){console.error("Error fetching devices:",s)}},U=async()=>{try{const s=await X.get("/api/method/beetwin_iot.beetwin_iot.api.device_diagnostic_data.get_device_diagnostic_data");console.log("API Response from Cloud:",s.data),s.data.message.status==="success"&&(x.value=s.data.message.data.map(t=>({deviceId:t["Device ID"],serialNumber:t["Serial Number"],timestamp:t.Timestamp.slice(0,16),latestDiagnosticData:{rc:t["Retry Count"],rst:t["Device Reset Status"],ht:t["Sensor Health"],ms:t["Mqtt Server Data Status"],sv:t["Device Software Version"],rssi:t["RSSI Value"]}})),console.log("DeviceList for Diagnostic:",x.value))}catch(s){console.error("Error fetching devices:",s)}},O=(s,t)=>{I.push({name:"DeviceDetails",params:{deviceId:s},query:{serialNumber:t}})},j=(s,t)=>{I.push({name:"DeviceDetails",params:{deviceId:s},query:{serialNumber:t}})},V=()=>{n.value<D.value&&n.value++},B=()=>{n.value>1&&n.value--};return C(()=>{M(),U()}),window.__homeState={selectedTab:S,searchQuery:w,currentPage:n,fetchDevices:M,fetchDiagnosticDevices:U,downloadReport:T,downloaddiagnosticReport:R,navigateToDevice:O,navigateToDiagnosticDevice:j,logout:L},(s,t)=>(d(),i("div",ne,[e("header",ie,[t[14]||(t[14]=e("img",{src:re,alt:"IoTweet Logo",class:"w-28"},null,-1)),t[15]||(t[15]=e("div",{class:"text-white flex-1 text-center font-bold text-xl"},"BEETWIN-HS DASHBOARD",-1)),e("button",{onClick:t[0]||(t[0]=(...o)=>s.toggleSidebar&&s.toggleSidebar(...o)),class:"lg:hidden text-white ml-auto"},t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])),e("div",{class:"relative ml-4",onClick:W},[e("button",de,[e("img",{src:l.value,alt:"User Image",class:"w-full h-full object-cover rounded-full"},null,8,ue)]),k.value?(d(),i("div",pe,[e("p",ce,r(K.value),1),e("a",{href:"#",onClick:t[1]||(t[1]=(...o)=>s.showAccountInfo&&s.showAccountInfo(...o)),class:"block px-4 py-2 text-gray-700 hover:bg-gray-100"},"Account Info"),e("a",{href:"#",onClick:L,class:"block px-4 py-2 text-gray-700 hover:bg-gray-100"},"Logout")])):g("",!0),s.showModal?(d(),i("div",me,[e("div",ge,[t[13]||(t[13]=e("h2",{class:"text-xl font-bold mb-4"},"Change Password",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.currentPassword=o),type:"password",placeholder:"Current Password",class:"w-full p-2 border rounded-md mb-2"},null,512),[[_,s.currentPassword]]),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.newPassword=o),type:"password",placeholder:"New Password",class:"w-full p-2 border rounded-md mb-2"},null,512),[[_,s.newPassword]]),y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.confirmPassword=o),type:"password",placeholder:"Confirm New Password",class:"w-full p-2 border rounded-md mb-4"},null,512),[[_,s.confirmPassword]]),e("button",{onClick:t[5]||(t[5]=(...o)=>s.changePassword&&s.changePassword(...o)),class:"w-full bg-blue-500 text-white p-2 rounded-md"},"Update Password"),e("button",{onClick:t[6]||(t[6]=o=>s.showModal=!1),class:"w-full mt-2 text-gray-600"},"Cancel"),s.errorMessage?(d(),i("p",be,r(s.errorMessage),1)):g("",!0),s.successMessage?(d(),i("p",he,r(s.successMessage),1)):g("",!0)])])):g("",!0)])]),e("main",we,[e("aside",{class:te([{hidden:!s.isSidebarOpen,"lg:block":!0,"bg-[#08444c] text-white p-5 border-r transition-all duration-300":!0},"mt-16"])},[e("nav",null,[e("ul",ye,[e("li",null,[e("a",{href:"#",onClick:z,class:"flex items-center space-x-2 hover:text-gray-300"},t[16]||(t[16]=[e("img",{src:ae,alt:"Download",class:"w-7 h-7"},null,-1),e("span",null,"Dashboard",-1)]))]),e("li",null,[e("a",{href:"#",onClick:t[7]||(t[7]=(...o)=>s.setDiagnosticTab&&s.setDiagnosticTab(...o)),class:"flex items-center space-x-2 hover:text-gray-300"},t[17]||(t[17]=[e("img",{src:le,alt:"Diagnostic Icon",class:"w-7 h-7"},null,-1),e("span",null,"Diagnostic",-1)]))])])])],2),S.value===2?(d(),i("div",ve,[e("div",xe,[t[19]||(t[19]=e("h2",{class:"text-lg font-semibold leading-[3.15] ml-[583px]"},"BTX-PP",-1)),e("div",De,[y(e("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=o=>w.value=o),placeholder:"Search Serial Number",class:"border p-2 rounded-md w-64"},null,512),[[_,w.value]]),e("button",{onClick:T,class:"ml-4"},t[18]||(t[18]=[e("img",{src:E,alt:"Download",class:"w-10 h-10"},null,-1)]))])]),e("div",fe,[t[24]||(t[24]=e("div",{class:"flex justify-end mb-2"},null,-1)),e("table",_e,[t[21]||(t[21]=e("thead",{class:"bg-[#08444c] text-white"},[e("tr",null,[e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Serial Number"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Device ID"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Timestamp"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Pressure (bar)"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Battery (%)"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Sensor Health"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Latitude"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Longitude"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Signal Strength")])],-1)),e("tbody",null,[h.value.length===0?(d(),i("tr",Pe,t[20]||(t[20]=[e("td",{colspan:"9",class:"text-center text-red-500 font-bold py-4"},"No allowed device groups found.",-1)]))):g("",!0),(d(!0),i(H,null,A(Y.value,o=>(d(),i("tr",{key:o.deviceId,onClick:c=>O(o.deviceId,o.serialNumber),class:"cursor-pointer hover:bg-gray-100 transition-all text-center"},[e("td",ke,r(o.serialNumber),1),e("td",Ne,r(o.deviceId),1),e("td",Ce,r(o.timestamp),1),e("td",Ie,r(o.latestData.pv),1),e("td",Te,r(o.latestData.bt),1),e("td",Re,r(o.latestData.ht==="0"?"Open":"Healthy"),1),e("td",Le,r(o.latestData.lat),1),e("td",Me,r(o.latestData.long),1),e("td",Ue,r(o.latestData.rssi),1)],8,Se))),128))])]),e("div",Oe,[e("div",null,[t[23]||(t[23]=e("label",{class:"mr-2"},"Items per page:",-1)),y(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>p.value=o),class:"border p-2 rounded-md w-15"},t[22]||(t[22]=[e("option",{value:"10"},"10",-1),e("option",{value:"25"},"25",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)]),512),[[q,p.value]])]),e("div",null,[e("button",{onClick:B,disabled:n.value===1,class:"px-4 py-2 border rounded-md bg-gray-200 mr-2"},"Prev",8,je),e("span",null,"Page "+r(n.value)+" of "+r(D.value),1),e("button",{onClick:V,disabled:n.value===D.value,class:"px-4 py-2 border rounded-md bg-gray-200 ml-2"},"Next",8,Ve)])])])])):g("",!0),S.value===1?(d(),i("div",Be,[e("div",He,[t[26]||(t[26]=e("h2",{class:"text-lg font-semibold leading-[3.15] ml-[583px]"},"DIAGNOSTIC",-1)),e("div",Ae,[y(e("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=o=>w.value=o),placeholder:"Search Serial Number",class:"border p-2 rounded-md w-64"},null,512),[[_,w.value]]),e("button",{onClick:R,class:"ml-4"},t[25]||(t[25]=[e("img",{src:E,alt:"Download",class:"w-10 h-10"},null,-1)]))])]),e("div",qe,[t[31]||(t[31]=e("div",{class:"flex justify-end mb-2"},null,-1)),e("table",Ee,[t[28]||(t[28]=e("thead",{class:"bg-[#08444c] text-white"},[e("tr",null,[e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Serial Number"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Device ID"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Timestamp"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Retry Count"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Device Reset Status"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Sensor Health"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Mqtt Server Status"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Device Software Version"),e("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Signal Strength")])],-1)),e("tbody",null,[x.value.length===0?(d(),i("tr",Xe,t[27]||(t[27]=[e("td",{colspan:"9",class:"text-center text-red-500 font-bold py-4"},"No allowed device groups found.",-1)]))):g("",!0),(d(!0),i(H,null,A(ee.value,o=>(d(),i("tr",{key:o.deviceId,onClick:c=>j(o.deviceId,o.serialNumber),class:"cursor-pointer hover:bg-gray-100 transition-all text-center"},[e("td",Fe,r(o.serialNumber),1),e("td",Ge,r(o.deviceId),1),e("td",Qe,r(o.timestamp),1),e("td",ze,r(o.latestDiagnosticData.rc),1),e("td",We,r(o.latestDiagnosticData.rst==="1"?"Reset":"Not Reset"),1),e("td",Ke,r(o.latestDiagnosticData.ht==="0"?"Open":"Healthy"),1),e("td",Ze,r(o.latestDiagnosticData.ms==="0"?"Data Not Sent":"Data Sent"),1),e("td",Je,r(o.latestDiagnosticData.sv),1),e("td",Ye,r(o.latestDiagnosticData.rssi),1)],8,$e))),128))])]),e("div",et,[e("div",null,[t[30]||(t[30]=e("label",{class:"mr-2"},"Items per page:",-1)),y(e("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>p.value=o),class:"border p-2 rounded-md w-15"},t[29]||(t[29]=[e("option",{value:"10"},"10",-1),e("option",{value:"25"},"25",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)]),512),[[q,p.value]])]),e("div",null,[e("button",{onClick:B,disabled:n.value===1,class:"px-4 py-2 border rounded-md bg-gray-200 mr-2"},"Prev",8,tt),e("span",null,"Page "+r(n.value)+" of "+r(D.value),1),e("button",{onClick:V,disabled:n.value===D.value,class:"px-4 py-2 border rounded-md bg-gray-200 ml-2"},"Next",8,st)])])])])):g("",!0)])]))}});export{Wt as default};
