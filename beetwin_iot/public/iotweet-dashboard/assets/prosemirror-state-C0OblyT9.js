import{S as m,F as J}from"./prosemirror-model-CDAhqB4x.js";import{R as x,b as C}from"./prosemirror-transform-DiPrUp-3.js";const S=Object.create(null);class l{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new E(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=m.empty){let n=t.content.lastChild,s=null;for(let o=0;o<t.openEnd;o++)s=n,n=n.lastChild;let i=e.steps.length,a=this.ranges;for(let o=0;o<a.length;o++){let{$from:h,$to:g}=a[o],f=e.mapping.slice(i);e.replaceRange(f.map(h.pos),f.map(g.pos),o?m.empty:t),o==0&&I(e,i,(n?n.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:a,$to:o}=s[i],h=e.mapping.slice(n),g=h.map(a.pos),f=h.map(o.pos);i?e.deleteRange(g,f):(e.replaceRangeWith(g,f,t),I(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let s=e.parent.inlineContent?new c(e):d(e.node(0),e.parent,e.pos,e.index(),t,n);if(s)return s;for(let i=e.depth-1;i>=0;i--){let a=t<0?d(e.node(0),e.node(i),e.before(i+1),e.index(i),t,n):d(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,n);if(a)return a}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new p(e.node(0))}static atStart(e){return d(e,e,0,0,1)||new p(e)}static atEnd(e){return d(e,e,e.content.size,e.childCount,-1)||new p(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=S[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in S)throw new RangeError("Duplicate use of selection JSON ID "+e);return S[e]=t,t.prototype.jsonID=e,t}getBookmark(){return c.between(this.$anchor,this.$head).getBookmark()}}l.prototype.visible=!0;class E{constructor(e,t){this.$from=e,this.$to=t}}let b=!1;function F(r){!b&&!r.parent.inlineContent&&(b=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class c extends l{constructor(e,t=e){F(e),F(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return l.near(n);let s=e.resolve(t.map(this.anchor));return new c(s.parent.inlineContent?s:n,n)}replace(e,t=m.empty){if(super.replace(e,t),t==m.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof c&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new y(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new c(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let s=e.resolve(t);return new this(s,n==t?s:e.resolve(n))}static between(e,t,n){let s=e.pos-t.pos;if((!n||s)&&(n=s>=0?1:-1),!t.parent.inlineContent){let i=l.findFrom(t,n,!0)||l.findFrom(t,-n,!0);if(i)t=i.$head;else return l.near(t,n)}return e.parent.inlineContent||(s==0?e=t:(e=(l.findFrom(e,-n,!0)||l.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=s<0&&(e=t))),new c(e,t)}}l.jsonID("text",c);class y{constructor(e,t){this.anchor=e,this.head=t}map(e){return new y(e.map(this.anchor),e.map(this.head))}resolve(e){return c.between(e.resolve(this.anchor),e.resolve(this.head))}}class u extends l{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:s}=t.mapResult(this.anchor),i=e.resolve(s);return n?l.near(i):new u(i)}content(){return new m(J.from(this.node),0,0)}eq(e){return e instanceof u&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new v(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new u(e.resolve(t.anchor))}static create(e,t){return new u(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}u.prototype.visible=!1;l.jsonID("node",u);class v{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new y(n,n):new v(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&u.isSelectable(n)?new u(t):l.near(t)}}class p extends l{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=m.empty){if(t==m.empty){e.delete(0,e.doc.content.size);let n=l.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new p(e)}map(e){return new p(e)}eq(e){return e instanceof p}getBookmark(){return D}}l.jsonID("all",p);const D={map(){return this},resolve(r){return new p(r)}};function d(r,e,t,n,s,i=!1){if(e.inlineContent)return c.create(r,t);for(let a=n-(s>0?0:1);s>0?a<e.childCount:a>=0;a+=s){let o=e.child(a);if(o.isAtom){if(!i&&u.isSelectable(o))return u.create(r,t-(s<0?o.nodeSize:0))}else{let h=d(r,o,t+s,s<0?o.childCount:0,s,i);if(h)return h}t+=o.nodeSize*s}return null}function I(r,e,t){let n=r.steps.length-1;if(n<e)return;let s=r.steps[n];if(!(s instanceof x||s instanceof C))return;let i=r.mapping.maps[n],a;i.forEach((o,h,g,f)=>{a==null&&(a=f)}),r.setSelection(l.near(r.doc.resolve(a),t))}function N(r,e){return!e||!r?r:r.bind(e)}class w{constructor(e,t,n){this.name=e,this.init=N(t.init,n),this.apply=N(t.apply,n)}}new w("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new w("selection",{init(r,e){return r.selection||l.atStart(e.doc)},apply(r){return r.selection}}),new w("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new w("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}});function R(r,e,t){for(let n in r){let s=r[n];s instanceof Function?s=s.bind(e):n=="handleDOMEvents"&&(s=R(s,e,{})),t[n]=s}return t}class T{constructor(e){this.spec=e,this.props={},e.props&&R(e.props,this,this.props),this.key=e.key?e.key.key:O("plugin")}getState(e){return e[this.key]}}const k=Object.create(null);function O(r){return r in k?r+"$"+ ++k[r]:(k[r]=0,r+"$")}class z{constructor(e="key"){this.key=O(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}export{p as A,u as N,T as P,l as S,c as T,z as a,E as b};
