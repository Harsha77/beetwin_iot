import{u as re,r as x,x as G,y as ie,z as ae,g as ue,o as le,w as z,A as ee,c as te,s as q}from"./@vue-6KHaxNJ6.js";function ne(e){return ue()?(le(e),!0):!1}function K(){const e=new Set,t=a=>{e.delete(a)};return{on:a=>{e.add(a);const r=()=>t(a);return ne(r),{off:r}},off:t,trigger:(...a)=>Promise.all(Array.from(e).map(r=>r(...a)))}}function b(e){return typeof e=="function"?e():re(e)}const oe=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const se=()=>{};function Z(e,t=!1,o="Timeout"){return new Promise((u,a)=>{setTimeout(t?()=>a(o):u,e)})}function ce(e,...t){return t.some(o=>o in e)}function Q(...e){if(e.length!==1)return ie(...e);const t=e[0];return typeof t=="function"?G(ae(()=>({get:t,set:se}))):x(t)}function R(e,t=!1){function o(i,{flush:s="sync",deep:p=!1,timeout:d,throwOnTimeout:E}={}){let m=null;const A=[new Promise(T=>{m=z(e,O=>{i(O)!==t&&(m==null||m(),T(O))},{flush:s,deep:p,immediate:!0})})];return d!=null&&A.push(Z(d,E).then(()=>b(e)).finally(()=>m==null?void 0:m())),Promise.race(A)}function u(i,s){if(!ee(i))return o(O=>O===i,s);const{flush:p="sync",deep:d=!1,timeout:E,throwOnTimeout:m}=s!=null?s:{};let y=null;const T=[new Promise(O=>{y=z([e,i],([P,C])=>{t!==(P===C)&&(y==null||y(),O(P))},{flush:p,deep:d,immediate:!0})})];return E!=null&&T.push(Z(E,m).then(()=>b(e)).finally(()=>(y==null||y(),b(e)))),Promise.race(T)}function a(i){return o(s=>!!s,i)}function r(i){return u(null,i)}function n(i){return u(void 0,i)}function v(i){return o(Number.isNaN,i)}function f(i,s){return o(p=>{const d=Array.from(p);return d.includes(i)||d.includes(b(i))},s)}function h(i){return w(1,i)}function w(i=1,s){let p=-1;return o(()=>(p+=1,p>=i),s)}return Array.isArray(b(e))?{toMatch:o,toContains:f,changed:h,changedTimes:w,get not(){return R(e,!t)}}:{toMatch:o,toBe:u,toBeTruthy:a,toBeNull:r,toBeNaN:v,toBeUndefined:n,changed:h,changedTimes:w,get not(){return R(e,!t)}}}function fe(e){return R(e)}function de(e,t,o={}){const{immediate:u=!0}=o,a=x(!1);let r=null;function n(){r&&(clearTimeout(r),r=null)}function v(){a.value=!1,n()}function f(...h){n(),a.value=!0,r=setTimeout(()=>{a.value=!1,r=null,e(...h)},b(t))}return u&&(a.value=!0,oe&&f()),ne(v),{isPending:G(a),start:f,stop:v}}const he=oe?window:void 0,pe={json:"application/json",text:"text/plain"};function M(e){return e&&ce(e,"immediate","refetch","initialData","timeout","beforeFetch","afterFetch","onFetchError","fetch","updateDataOnError")}const me=/^(?:[a-z][a-z\d+\-.]*:)?\/\//i;function ye(e){return me.test(e)}function N(e){return typeof Headers!="undefined"&&e instanceof Headers?Object.fromEntries(e.entries()):e}function U(e,...t){return e==="overwrite"?async o=>{const u=t[t.length-1];return u?{...o,...await u(o)}:o}:async o=>{for(const u of t)u&&(o={...o,...await u(o)});return o}}function we(e={}){const t=e.combination||"chain",o=e.options||{},u=e.fetchOptions||{};function a(r,...n){const v=te(()=>{const w=b(e.baseUrl),i=b(r);return w&&!ye(i)?be(w,i):i});let f=o,h=u;return n.length>0&&(M(n[0])?f={...f,...n[0],beforeFetch:U(t,o.beforeFetch,n[0].beforeFetch),afterFetch:U(t,o.afterFetch,n[0].afterFetch),onFetchError:U(t,o.onFetchError,n[0].onFetchError)}:h={...h,...n[0],headers:{...N(h.headers)||{},...N(n[0].headers)||{}}}),n.length>1&&M(n[1])&&(f={...f,...n[1],beforeFetch:U(t,o.beforeFetch,n[1].beforeFetch),afterFetch:U(t,o.afterFetch,n[1].afterFetch),onFetchError:U(t,o.onFetchError,n[1].onFetchError)}),Fe(v,h,f)}return a}function Fe(e,...t){var o;const u=typeof AbortController=="function";let a={},r={immediate:!0,refetch:!1,timeout:0,updateDataOnError:!1};const n={method:"GET",type:"text",payload:void 0};t.length>0&&(M(t[0])?r={...r,...t[0]}:a=t[0]),t.length>1&&M(t[1])&&(r={...r,...t[1]});const{fetch:v=(o=he)==null?void 0:o.fetch,initialData:f,timeout:h}=r,w=K(),i=K(),s=K(),p=x(!1),d=x(!1),E=x(!1),m=x(null),y=q(null),A=q(null),T=q(f||null),O=te(()=>u&&d.value);let P,C;const I=()=>{u&&(P==null||P.abort(),P=new AbortController,P.signal.onabort=()=>E.value=!0,a={...a,signal:P.signal})},J=c=>{d.value=c,p.value=!c};h&&(C=de(I,h,{immediate:!1}));let L=0;const W=async(c=!1)=>{var F,g;I(),J(!0),A.value=null,m.value=null,E.value=!1,L+=1;const k=L,B={method:n.method,headers:{}};if(n.payload){const l=N(B.headers),D=b(n.payload);!n.payloadType&&D&&Object.getPrototypeOf(D)===Object.prototype&&!(D instanceof FormData)&&(n.payloadType="json"),n.payloadType&&(l["Content-Type"]=(F=pe[n.payloadType])!=null?F:n.payloadType),B.body=n.payloadType==="json"?JSON.stringify(D):D}let Y=!1;const H={url:b(e),options:{...B,...a},cancel:()=>{Y=!0}};if(r.beforeFetch&&Object.assign(H,await r.beforeFetch(H)),Y||!v)return J(!1),Promise.resolve(null);let S=null;return C&&C.start(),v(H.url,{...B,...H.options,headers:{...N(B.headers),...N((g=H.options)==null?void 0:g.headers)}}).then(async l=>{if(y.value=l,m.value=l.status,S=await l.clone()[n.type](),!l.ok)throw T.value=f||null,new Error(l.statusText);return r.afterFetch&&({data:S}=await r.afterFetch({data:S,response:l})),T.value=S,w.trigger(l),l}).catch(async l=>{let D=l.message||l.name;if(r.onFetchError&&({error:D,data:S}=await r.onFetchError({data:S,error:l,response:y.value})),A.value=D,r.updateDataOnError&&(T.value=S),i.trigger(l),c)throw l;return null}).finally(()=>{k===L&&J(!1),C&&C.stop(),s.trigger(null)})},X=Q(r.refetch);z([X,Q(e)],([c])=>c&&W(),{deep:!0});const $={isFinished:G(p),isFetching:G(d),statusCode:m,response:y,error:A,data:T,canAbort:O,aborted:E,abort:I,execute:W,onFetchResponse:w.on,onFetchError:i.on,onFetchFinally:s.on,get:j("GET"),put:j("PUT"),post:j("POST"),delete:j("DELETE"),patch:j("PATCH"),head:j("HEAD"),options:j("OPTIONS"),json:_("json"),text:_("text"),blob:_("blob"),arrayBuffer:_("arrayBuffer"),formData:_("formData")};function j(c){return(F,g)=>{if(!d.value)return n.method=c,n.payload=F,n.payloadType=g,ee(n.payload)&&z([X,Q(n.payload)],([k])=>k&&W(),{deep:!0}),{...$,then(k,B){return V().then(k,B)}}}}function V(){return new Promise((c,F)=>{fe(p).toBe(!0).then(()=>c($)).catch(g=>F(g))})}function _(c){return()=>{if(!d.value)return n.type=c,{...$,then(F,g){return V().then(F,g)}}}}return r.immediate&&Promise.resolve().then(()=>W()),{...$,then(c,F){return V().then(c,F)}}}function be(e,t){return!e.endsWith("/")&&!t.startsWith("/")?`${e}/${t}`:`${e}${t}`}export{we as c};
