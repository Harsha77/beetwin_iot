import{P,a as B,S as F,T as I,N as ut}from"./prosemirror-state-DgsmxDjm.js";import{d as Qt}from"./prosemirror-dropcursor-BfstMEHz.js";import{g as Jt}from"./prosemirror-gapcursor-DAo5-j_C.js";import{u as Ut,r as Zt,h as Yt}from"./prosemirror-history-DKyN9Nbl.js";import{D as jt,a as zt}from"./prosemirror-view-W--SXXbD.js";import{a as Xt,b as te,d as ee,c as ne,e as se,f as re,g as oe,m as At,s as vt,t as St,h as ie,i as ae,j as wt,k as le,C as Dt,l as ce,n as de}from"./prosemirror-tables-DrV9oBPp.js";import{r as Ct,f as lt,a as ue}from"./linkifyjs-Bb8FdQht.js";import{F as Z,S as pe,D as fe}from"./prosemirror-model-C_7RDaDb.js";import{f as he,c as pt,T as me,l as ge,j as Ft,a as Y,R as ye,b as ke}from"./prosemirror-transform-DoYUQK9o.js";import{c as be,d as Me,e as xe,j as Te,a as Ae,b as ve,f as Se,l as we,g as Ce,n as Le,s as $e,h as He,i as Ee,k as Ie,m as Oe,o as Lt,w as Re}from"./prosemirror-commands-Lnq4s3Q2.js";import{l as Be,s as Pe,w as Ne}from"./prosemirror-schema-list-B9x1aVA0.js";function Wt(t){const{state:e,transaction:n}=t;let{selection:s}=n,{doc:r}=n,{storedMarks:o}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),filterTransaction:e.filterTransaction,plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return s},get doc(){return r},get tr(){return s=n.selection,r=n.doc,o=n.storedMarks,n}}}class _e{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:s}=this,{view:r}=n,{tr:o}=s,i=this.buildProps(o);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...p)=>{const d=l(...p)(i);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(o),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:s,editor:r,state:o}=this,{view:i}=r,a=[],l=!!e,c=e||o.tr,p=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(c),a.every(f=>f===!0)),d={...Object.fromEntries(Object.entries(s).map(([f,u])=>[f,(...h)=>{const m=this.buildProps(c,n),k=u(...h)(m);return a.push(k),d}])),run:p};return d}createCan(e){const{rawCommands:n,state:s}=this,r=!1,o=e||s.tr,i=this.buildProps(o,r);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...p)=>c(...p)({...i,dispatch:void 0})])),chain:()=>this.createChain(o,r)}}buildProps(e,n=!0){const{rawCommands:s,editor:r,state:o}=this,{view:i}=r,a={tr:e,editor:r,view:i,state:Wt({state:o,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(s).map(([l,c])=>[l,(...p)=>c(...p)(a)]))}};return a}}function w(t,e,n){return t.config[e]===void 0&&t.parent?w(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?w(t.parent,e,n):null}):t.config[e]}function je(t){const e=t.filter(r=>r.type==="extension"),n=t.filter(r=>r.type==="node"),s=t.filter(r=>r.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:s}}function L(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function M(...t){return t.filter(e=>!!e).reduce((e,n)=>{const s={...e};return Object.entries(n).forEach(([r,o])=>{if(!s[r]){s[r]=o;return}if(r==="class"){const a=o?o.split(" "):[],l=s[r]?s[r].split(" "):[],c=a.filter(p=>!l.includes(p));s[r]=[...l,...c].join(" ")}else r==="style"?s[r]=[s[r],o].join("; "):s[r]=o}),s},{})}function ze(t){return typeof t=="function"}function T(t,e=void 0,...n){return ze(t)?e?t.bind(e)(...n):t(...n):t}function De(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class G{constructor(e){this.find=e.find,this.handler=e.handler}}class Fe{constructor(e){this.find=e.find,this.handler=e.handler}}function We(t){return Object.prototype.toString.call(t).slice(8,-1)}function ot(t){return We(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function nt(t,e){const n={...t};return ot(t)&&ot(e)&&Object.keys(e).forEach(s=>{ot(e[s])?s in t?n[s]=nt(t[s],e[s]):Object.assign(n,{[s]:e[s]}):Object.assign(n,{[s]:e[s]})}),n}class ${constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=T(w(this,"addOptions",{name:this.name}))),this.storage=T(w(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new $(e)}configure(e={}){const n=this.extend();return n.options=nt(this.options,e),n.storage=T(w(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new $(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=T(w(n,"addOptions",{name:n.name})),n.storage=T(w(n,"addStorage",{name:n.name,options:n.options})),n}}function Ke(t,e,n){const{from:s,to:r}=e,{blockSeparator:o=`

`,textSerializers:i={}}=n||{};let a="",l=!0;return t.nodesBetween(s,r,(c,p,d,f)=>{var u;const g=i==null?void 0:i[c.type.name];g?(c.isBlock&&!l&&(a+=o,l=!0),d&&(a+=g({node:c,pos:p,parent:d,index:f,range:e}))):c.isText?(a+=(u=c==null?void 0:c.text)===null||u===void 0?void 0:u.slice(Math.max(s,p)-p,r-p),l=!1):c.isBlock&&!l&&(a+=o,l=!0)}),a}function qe(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}$.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new P({key:new B("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:s,selection:r}=e,{ranges:o}=r,i=Math.min(...o.map(p=>p.$from.pos)),a=Math.max(...o.map(p=>p.$to.pos)),l=qe(n);return Ke(s,{from:i,to:a},{textSerializers:l})}}})]}});const Ve=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),Ge=(t=!1)=>({commands:e})=>e.setContent("",t),Qe=()=>({state:t,tr:e,dispatch:n})=>{const{selection:s}=e,{ranges:r}=s;return n&&r.forEach(({$from:o,$to:i})=>{t.doc.nodesBetween(o.pos,i.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:p}=e,d=c.resolve(p.map(l)),f=c.resolve(p.map(l+a.nodeSize)),u=d.blockRange(f);if(!u)return;const g=ge(u);if(a.type.isTextblock){const{defaultType:h}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(u.start,h)}(g||g===0)&&e.lift(u,g)})}),!0},Je=t=>e=>t(e),Ue=()=>({state:t,dispatch:e})=>be(t,e),Ze=(t,e)=>({editor:n,tr:s})=>{const{state:r}=n,o=r.doc.slice(t.from,t.to);s.deleteRange(t.from,t.to);const i=s.mapping.map(e);return s.insert(i,o.content),s.setSelection(new I(s.doc.resolve(i-1))),!0},Ye=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,s=n.$anchor.node();if(s.content.size>0)return!1;const r=t.selection.$anchor;for(let o=r.depth;o>0;o-=1)if(r.node(o).type===s.type){if(e){const a=r.before(o),l=r.after(o);t.delete(a,l).scrollIntoView()}return!0}return!1},Xe=t=>({tr:e,state:n,dispatch:s})=>{const r=L(t,n.schema),o=e.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===r){if(s){const l=o.before(i),c=o.after(i);e.delete(l,c).scrollIntoView()}return!0}return!1},tn=t=>({tr:e,dispatch:n})=>{const{from:s,to:r}=t;return n&&e.delete(s,r),!0},en=()=>({state:t,dispatch:e})=>Me(t,e),nn=()=>({commands:t})=>t.keyboardShortcut("Enter"),sn=()=>({state:t,dispatch:e})=>xe(t,e);function tt(t,e,n={strict:!0}){const s=Object.keys(e);return s.length?s.every(r=>n.strict?e[r]===t[r]:De(e[r])?e[r].test(t[r]):e[r]===t[r]):!0}function ct(t,e,n={}){return t.find(s=>s.type===e&&tt(s.attrs,n))}function rn(t,e,n={}){return!!ct(t,e,n)}function ft(t,e,n={}){if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if(t.parentOffset===s.offset&&s.offset!==0&&(s=t.parent.childBefore(t.parentOffset)),!s.node)return;const r=ct([...s.node.marks],e,n);if(!r)return;let o=s.index,i=t.start()+s.offset,a=o+1,l=i+s.node.nodeSize;for(ct([...s.node.marks],e,n);o>0&&r.isInSet(t.parent.child(o-1).marks);)o-=1,i-=t.parent.child(o).nodeSize;for(;a<t.parent.childCount&&rn([...t.parent.child(a).marks],e,n);)l+=t.parent.child(a).nodeSize,a+=1;return{from:i,to:l}}function N(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const on=(t,e={})=>({tr:n,state:s,dispatch:r})=>{const o=N(t,s.schema),{doc:i,selection:a}=n,{$from:l,from:c,to:p}=a;if(r){const d=ft(l,o,e);if(d&&d.from<=c&&d.to>=p){const f=I.create(i,d.from,d.to);n.setSelection(f)}}return!0},an=t=>e=>{const n=typeof t=="function"?t(e):t;for(let s=0;s<n.length;s+=1)if(n[s](e))return!0;return!1};function Kt(t){return t instanceof I}function _(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function ln(t,e=null){if(!e)return null;const n=F.atStart(t),s=F.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return s;const r=n.from,o=s.to;return e==="all"?I.create(t,_(0,r,o),_(t.content.size,r,o)):I.create(t,_(e,r,o),_(e,r,o))}function ht(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const cn=(t=null,e={})=>({editor:n,view:s,tr:r,dispatch:o})=>{e={scrollIntoView:!0,...e};const i=()=>{ht()&&s.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(s.hasFocus()&&t===null||t===!1)return!0;if(o&&t===null&&!Kt(n.state.selection))return i(),!0;const a=ln(r.doc,t)||n.state.selection,l=n.state.selection.eq(a);return o&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),i()),!0},dn=(t,e)=>n=>t.every((s,r)=>e(s,{...n,index:r})),un=(t,e)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},t,e);function $t(t){const e=`<body>${t}</body>`;return new window.DOMParser().parseFromString(e,"text/html").body}function et(t,e,n){if(n={slice:!0,parseOptions:{},...n},typeof t=="object"&&t!==null)try{return Array.isArray(t)&&t.length>0?Z.fromArray(t.map(s=>e.nodeFromJSON(s))):e.nodeFromJSON(t)}catch(s){return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),et("",e,n)}if(typeof t=="string"){const s=fe.fromSchema(e);return n.slice?s.parseSlice($t(t),n.parseOptions).content:s.parse($t(t),n.parseOptions)}return et("",e,n)}function pn(t,e,n){const s=t.steps.length-1;if(s<e)return;const r=t.steps[s];if(!(r instanceof ye||r instanceof ke))return;const o=t.mapping.maps[s];let i=0;o.forEach((a,l,c,p)=>{i===0&&(i=p)}),t.setSelection(F.near(t.doc.resolve(i),n))}const fn=t=>t.toString().startsWith("<"),hn=(t,e,n)=>({tr:s,dispatch:r,editor:o})=>{if(r){n={parseOptions:{},updateSelection:!0,...n};const i=et(e,o.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if(i.toString()==="<>")return!0;let{from:a,to:l}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},c=!0,p=!0;if((fn(i)?i:[i]).forEach(f=>{f.check(),c=c?f.isText&&f.marks.length===0:!1,p=p?f.isBlock:!1}),a===l&&p){const{parent:f}=s.doc.resolve(a);f.isTextblock&&!f.type.spec.code&&!f.childCount&&(a-=1,l+=1)}c?Array.isArray(e)?s.insertText(e.map(f=>f.text||"").join(""),a,l):typeof e=="object"&&e&&e.text?s.insertText(e.text,a,l):s.insertText(e,a,l):s.replaceWith(a,l,i),n.updateSelection&&pn(s,s.steps.length-1,-1)}return!0},mn=()=>({state:t,dispatch:e})=>Te(t,e),gn=()=>({state:t,dispatch:e})=>Ae(t,e),yn=()=>({state:t,dispatch:e})=>ve(t,e),kn=()=>({state:t,dispatch:e})=>Se(t,e),bn=()=>({tr:t,state:e,dispatch:n})=>{try{const s=Ft(e.doc,e.selection.$from.pos,-1);return s==null?!1:(t.join(s,2),n&&n(t),!0)}catch(s){return!1}},Mn=()=>({state:t,dispatch:e,tr:n})=>{try{const s=Ft(t.doc,t.selection.$from.pos,1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch(s){return!1}};function mt(){return typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1}function xn(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let s,r,o,i;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))i=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))ht()||mt()?i=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return s&&(n=`Alt-${n}`),r&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}const Tn=t=>({editor:e,view:n,tr:s,dispatch:r})=>{const o=xn(t).split(/-(?!$)/),i=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const p=c.map(s.mapping);p&&r&&s.maybeStep(p)}),!0};function gt(t,e,n={}){const{from:s,to:r,empty:o}=t.selection,i=e?L(e,t.schema):null,a=[];t.doc.nodesBetween(s,r,(d,f)=>{if(d.isText)return;const u=Math.max(s,f),g=Math.min(r,f+d.nodeSize);a.push({node:d,from:u,to:g})});const l=r-s,c=a.filter(d=>i?i.name===d.node.type.name:!0).filter(d=>tt(d.node.attrs,n,{strict:!1}));return o?!!c.length:c.reduce((d,f)=>d+f.to-f.from,0)>=l}const An=(t,e={})=>({state:n,dispatch:s})=>{const r=L(t,n.schema);return gt(n,r,e)?we(n,s):!1},vn=()=>({state:t,dispatch:e})=>Ce(t,e),Sn=t=>({state:e,dispatch:n})=>{const s=L(t,e.schema);return Be(s)(e,n)},wn=()=>({state:t,dispatch:e})=>Le(t,e);function yt(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Ht(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((s,r)=>(n.includes(r)||(s[r]=t[r]),s),{})}const Cn=(t,e)=>({tr:n,state:s,dispatch:r})=>{let o=null,i=null;const a=yt(typeof t=="string"?t:t.name,s.schema);return a?(a==="node"&&(o=L(t,s.schema)),a==="mark"&&(i=N(t,s.schema)),r&&n.selection.ranges.forEach(l=>{s.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,p)=>{o&&o===c.type&&n.setNodeMarkup(p,void 0,Ht(c.attrs,e)),i&&c.marks.length&&c.marks.forEach(d=>{i===d.type&&n.addMark(p,p+c.nodeSize,i.create(Ht(d.attrs,e)))})})}),!0):!1},Ln=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),$n=()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size}),Hn=()=>({state:t,dispatch:e})=>$e(t,e),En=()=>({state:t,dispatch:e})=>He(t,e),In=()=>({state:t,dispatch:e})=>Ee(t,e),On=()=>({state:t,dispatch:e})=>Ie(t,e),Rn=()=>({state:t,dispatch:e})=>Oe(t,e);function Bn(t,e,n={}){return et(t,e,{slice:!1,parseOptions:n})}const Pn=(t,e=!1,n={})=>({tr:s,editor:r,dispatch:o})=>{const{doc:i}=s,a=Bn(t,r.schema,n);return o&&s.replaceWith(0,i.content.size,a).setMeta("preventUpdate",!e),!0};function Q(t,e){const n=N(e,t.schema),{from:s,to:r,empty:o}=t.selection,i=[];o?(t.storedMarks&&i.push(...t.storedMarks),i.push(...t.selection.$head.marks())):t.doc.nodesBetween(s,r,l=>{i.push(...l.marks)});const a=i.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function Nn(t,e){const n=new me(t);return e.forEach(s=>{s.steps.forEach(r=>{n.step(r)})}),n}function _n(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function jn(t,e,n){const s=[];return t.nodesBetween(e.from,e.to,(r,o)=>{n(r)&&s.push({node:r,pos:o})}),s}function qt(t,e){for(let n=t.depth;n>0;n-=1){const s=t.node(n);if(e(s))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:s}}}function kt(t){return e=>qt(e.$from,t)}function zn(t,e){const n=L(e,t.schema),{from:s,to:r}=t.selection,o=[];t.doc.nodesBetween(s,r,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===n.name);return i?{...i.attrs}:{}}function Dn(t,e){const n=yt(typeof e=="string"?e:e.name,t.schema);return n==="node"?zn(t,e):n==="mark"?Q(t,e):{}}function Fn(t,e=JSON.stringify){const n={};return t.filter(s=>{const r=e(s);return Object.prototype.hasOwnProperty.call(n,r)?!1:n[r]=!0})}function Wn(t){const e=Fn(t);return e.length===1?e:e.filter((n,s)=>!e.filter((o,i)=>i!==s).some(o=>n.oldRange.from>=o.oldRange.from&&n.oldRange.to<=o.oldRange.to&&n.newRange.from>=o.newRange.from&&n.newRange.to<=o.newRange.to))}function Kn(t){const{mapping:e,steps:n}=t,s=[];return e.maps.forEach((r,o)=>{const i=[];if(r.ranges.length)r.forEach((a,l)=>{i.push({from:a,to:l})});else{const{from:a,to:l}=n[o];if(a===void 0||l===void 0)return;i.push({from:a,to:l})}i.forEach(({from:a,to:l})=>{const c=e.slice(o).map(a,-1),p=e.slice(o).map(l),d=e.invert().map(c,-1),f=e.invert().map(p);s.push({oldRange:{from:d,to:f},newRange:{from:c,to:p}})})}),Wn(s)}function bt(t,e,n){const s=[];return t===e?n.resolve(t).marks().forEach(r=>{const o=n.resolve(t-1),i=ft(o,r.type);i&&s.push({mark:r,...i})}):n.nodesBetween(t,e,(r,o)=>{s.push(...r.marks.map(i=>({from:o,to:o+r.nodeSize,mark:i})))}),s}function X(t,e,n){return Object.fromEntries(Object.entries(n).filter(([s])=>{const r=t.find(o=>o.type===e&&o.name===s);return r?r.attribute.keepOnSplit:!1}))}function qn(t,e,n={}){const{empty:s,ranges:r}=t.selection,o=e?N(e,t.schema):null;if(s)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>tt(d.attrs,n,{strict:!1}));let i=0;const a=[];if(r.forEach(({$from:d,$to:f})=>{const u=d.pos,g=f.pos;t.doc.nodesBetween(u,g,(h,m)=>{if(!h.isText&&!h.marks.length)return;const k=Math.max(u,m),y=Math.min(g,m+h.nodeSize),x=y-k;i+=x,a.push(...h.marks.map(C=>({mark:C,from:k,to:y})))})}),i===0)return!1;const l=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>tt(d.mark.attrs,n,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),c=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,f)=>d+f.to-f.from,0);return(l>0?l+c:l)>=i}function Et(t,e){const{nodeExtensions:n}=je(e),s=n.find(i=>i.name===t);if(!s)return!1;const r={name:s.name,options:s.options,storage:s.storage},o=T(w(s,"group",r));return typeof o!="string"?!1:o.split(" ").includes("list")}function Vn(t,e,n){var s;const{selection:r}=e;let o=null;if(Kt(r)&&(o=r.$cursor),o){const a=(s=t.storedMarks)!==null&&s!==void 0?s:o.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:i}=r;return i.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(p,d,f)=>{if(c)return!1;if(p.isInline){const u=!f||f.type.allowsMarkType(n),g=!!n.isInSet(p.marks)||!p.marks.some(h=>h.type.excludes(n));c=u&&g}return!c}),c})}const Gn=(t,e={})=>({tr:n,state:s,dispatch:r})=>{const{selection:o}=n,{empty:i,ranges:a}=o,l=N(t,s.schema);if(r)if(i){const c=Q(s,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const p=c.$from.pos,d=c.$to.pos;s.doc.nodesBetween(p,d,(f,u)=>{const g=Math.max(u,p),h=Math.min(u+f.nodeSize,d);f.marks.find(k=>k.type===l)?f.marks.forEach(k=>{l===k.type&&n.addMark(g,h,l.create({...k.attrs,...e}))}):n.addMark(g,h,l.create(e))})});return Vn(s,n,l)},Qn=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),Jn=(t,e={})=>({state:n,dispatch:s,chain:r})=>{const o=L(t,n.schema);return o.isTextblock?r().command(({commands:i})=>Lt(o,e)(n)?!0:i.clearNodes()).command(({state:i})=>Lt(o,e)(i,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Un=t=>({tr:e,dispatch:n})=>{if(n){const{doc:s}=e,r=_(t,0,s.content.size),o=ut.create(s,r);e.setSelection(o)}return!0},Zn=t=>({tr:e,dispatch:n})=>{if(n){const{doc:s}=e,{from:r,to:o}=typeof t=="number"?{from:t,to:t}:t,i=I.atStart(s).from,a=I.atEnd(s).to,l=_(r,i,a),c=_(o,i,a),p=I.create(s,l,c);e.setSelection(p)}return!0},Yn=t=>({state:e,dispatch:n})=>{const s=L(t,e.schema);return Pe(s)(e,n)};function It(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const s=n.filter(r=>e==null?void 0:e.includes(r.type.name));t.tr.ensureMarks(s)}}const Xn=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:s,editor:r})=>{const{selection:o,doc:i}=e,{$from:a,$to:l}=o,c=r.extensionManager.attributes,p=X(c,a.node().type.name,a.node().attrs);if(o instanceof ut&&o.node.isBlock)return!a.parentOffset||!Y(i,a.pos)?!1:(s&&(t&&It(n,r.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(s){const d=l.parentOffset===l.parent.content.size;o instanceof I&&e.deleteSelection();const f=a.depth===0?void 0:_n(a.node(-1).contentMatchAt(a.indexAfter(-1)));let u=d&&f?[{type:f,attrs:p}]:void 0,g=Y(e.doc,e.mapping.map(a.pos),1,u);if(!u&&!g&&Y(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(g=!0,u=f?[{type:f,attrs:p}]:void 0),g&&(e.split(e.mapping.map(a.pos),1,u),f&&!d&&!a.parentOffset&&a.parent.type!==f)){const h=e.mapping.map(a.before()),m=e.doc.resolve(h);a.node(-1).canReplaceWith(m.index(),m.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}t&&It(n,r.extensionManager.splittableMarks),e.scrollIntoView()}return!0},ts=t=>({tr:e,state:n,dispatch:s,editor:r})=>{var o;const i=L(t,n.schema),{$from:a,$to:l}=n.selection,c=n.selection.node;if(c&&c.isBlock||a.depth<2||!a.sameParent(l))return!1;const p=a.node(-1);if(p.type!==i)return!1;const d=r.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==i||a.index(-2)!==a.node(-2).childCount-1)return!1;if(s){let m=Z.empty;const k=a.index(-1)?1:a.index(-2)?2:3;for(let E=a.depth-k;E>=a.depth-3;E-=1)m=Z.from(a.node(E).copy(m));const y=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,x=X(d,a.node().type.name,a.node().attrs),C=((o=i.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(x))||void 0;m=m.append(Z.from(i.createAndFill(null,C)||void 0));const v=a.before(a.depth-(k-1));e.replace(v,a.after(-y),new pe(m,4-k,0));let H=-1;e.doc.nodesBetween(v,e.doc.content.size,(E,b)=>{if(H>-1)return!1;E.isTextblock&&E.content.size===0&&(H=b+1)}),H>-1&&e.setSelection(I.near(e.doc.resolve(H))),e.scrollIntoView()}return!0}const f=l.pos===a.end()?p.contentMatchAt(0).defaultType:null,u=X(d,p.type.name,p.attrs),g=X(d,a.node().type.name,a.node().attrs);e.delete(a.pos,l.pos);const h=f?[{type:i,attrs:u},{type:f,attrs:g}]:[{type:i,attrs:u}];if(!Y(e.doc,a.pos,2))return!1;if(s){const{selection:m,storedMarks:k}=n,{splittableMarks:y}=r.extensionManager,x=k||m.$to.parentOffset&&m.$from.marks();if(e.split(a.pos,2,h).scrollIntoView(),!x||!s)return!0;const C=x.filter(v=>y.includes(v.type.name));e.ensureMarks(C)}return!0},it=(t,e)=>{const n=kt(i=>i.type===e)(t.selection);if(!n)return!0;const s=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(s===void 0)return!0;const r=t.doc.nodeAt(s);return n.node.type===(r==null?void 0:r.type)&&pt(t.doc,n.pos)&&t.join(n.pos),!0},at=(t,e)=>{const n=kt(i=>i.type===e)(t.selection);if(!n)return!0;const s=t.doc.resolve(n.start).after(n.depth);if(s===void 0)return!0;const r=t.doc.nodeAt(s);return n.node.type===(r==null?void 0:r.type)&&pt(t.doc,s)&&t.join(s),!0},es=(t,e,n,s={})=>({editor:r,tr:o,state:i,dispatch:a,chain:l,commands:c,can:p})=>{const{extensions:d,splittableMarks:f}=r.extensionManager,u=L(t,i.schema),g=L(e,i.schema),{selection:h,storedMarks:m}=i,{$from:k,$to:y}=h,x=k.blockRange(y),C=m||h.$to.parentOffset&&h.$from.marks();if(!x)return!1;const v=kt(H=>Et(H.type.name,d))(h);if(x.depth>=1&&v&&x.depth-v.depth<=1){if(v.node.type===u)return c.liftListItem(g);if(Et(v.node.type.name,d)&&u.validContent(v.node.content)&&a)return l().command(()=>(o.setNodeMarkup(v.pos,u),!0)).command(()=>it(o,u)).command(()=>at(o,u)).run()}return!n||!C||!a?l().command(()=>p().wrapInList(u,s)?!0:c.clearNodes()).wrapInList(u,s).command(()=>it(o,u)).command(()=>at(o,u)).run():l().command(()=>{const H=p().wrapInList(u,s),E=C.filter(b=>f.includes(b.type.name));return o.ensureMarks(E),H?!0:c.clearNodes()}).wrapInList(u,s).command(()=>it(o,u)).command(()=>at(o,u)).run()},ns=(t,e={},n={})=>({state:s,commands:r})=>{const{extendEmptyMarkRange:o=!1}=n,i=N(t,s.schema);return qn(s,i,e)?r.unsetMark(i,{extendEmptyMarkRange:o}):r.setMark(i,e)},ss=(t,e,n={})=>({state:s,commands:r})=>{const o=L(t,s.schema),i=L(e,s.schema);return gt(s,o,n)?r.setNode(i):r.setNode(o,n)},rs=(t,e={})=>({state:n,commands:s})=>{const r=L(t,n.schema);return gt(n,r,e)?s.lift(r):s.wrapIn(r,e)},os=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let s=0;s<n.length;s+=1){const r=n[s];let o;if(r.spec.isInputRules&&(o=r.getState(t))){if(e){const i=t.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)i.step(a.steps[l].invert(a.docs[l]));if(o.text){const l=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,t.schema.text(o.text,l))}else i.delete(o.from,o.to)}return!0}}return!1},is=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:s,ranges:r}=n;return s||e&&r.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},as=(t,e={})=>({tr:n,state:s,dispatch:r})=>{var o;const{extendEmptyMarkRange:i=!1}=e,{selection:a}=n,l=N(t,s.schema),{$from:c,empty:p,ranges:d}=a;if(!r)return!0;if(p&&i){let{from:f,to:u}=a;const g=(o=c.marks().find(m=>m.type===l))===null||o===void 0?void 0:o.attrs,h=ft(c,l,g);h&&(f=h.from,u=h.to),n.removeMark(f,u,l)}else d.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,l)});return n.removeStoredMark(l),!0},ls=(t,e={})=>({tr:n,state:s,dispatch:r})=>{let o=null,i=null;const a=yt(typeof t=="string"?t:t.name,s.schema);return a?(a==="node"&&(o=L(t,s.schema)),a==="mark"&&(i=N(t,s.schema)),r&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,p=l.$to.pos;s.doc.nodesBetween(c,p,(d,f)=>{o&&o===d.type&&n.setNodeMarkup(f,void 0,{...d.attrs,...e}),i&&d.marks.length&&d.marks.forEach(u=>{if(i===u.type){const g=Math.max(f,c),h=Math.min(f+d.nodeSize,p);n.addMark(g,h,i.create({...u.attrs,...e}))}})})}),!0):!1},cs=(t,e={})=>({state:n,dispatch:s})=>{const r=L(t,n.schema);return Re(r,e)(n,s)},ds=(t,e={})=>({state:n,dispatch:s})=>{const r=L(t,n.schema);return Ne(r,e)(n,s)};var us=Object.freeze({__proto__:null,blur:Ve,clearContent:Ge,clearNodes:Qe,command:Je,createParagraphNear:Ue,cut:Ze,deleteCurrentNode:Ye,deleteNode:Xe,deleteRange:tn,deleteSelection:en,enter:nn,exitCode:sn,extendMarkRange:on,first:an,focus:cn,forEach:dn,insertContent:un,insertContentAt:hn,joinUp:mn,joinDown:gn,joinBackward:yn,joinForward:kn,joinItemBackward:bn,joinItemForward:Mn,keyboardShortcut:Tn,lift:An,liftEmptyBlock:vn,liftListItem:Sn,newlineInCode:wn,resetAttributes:Cn,scrollIntoView:Ln,selectAll:$n,selectNodeBackward:Hn,selectNodeForward:En,selectParentNode:In,selectTextblockEnd:On,selectTextblockStart:Rn,setContent:Pn,setMark:Gn,setMeta:Qn,setNode:Jn,setNodeSelection:Un,setTextSelection:Zn,sinkListItem:Yn,splitBlock:Xn,splitListItem:ts,toggleList:es,toggleMark:ns,toggleNode:ss,toggleWrap:rs,undoInputRule:os,unsetAllMarks:is,unsetMark:as,updateAttributes:ls,wrapIn:cs,wrapInList:ds});$.create({name:"commands",addCommands(){return{...us}}});$.create({name:"editable",addProseMirrorPlugins(){return[new P({key:new B("editable"),props:{editable:()=>this.editor.options.editable}})]}});$.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new P({key:new B("focusEvents"),props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const s=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1},blur:(e,n)=>{t.isFocused=!1;const s=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1}}}})]}});$.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:p,$anchor:d}=l,{pos:f,parent:u}=d,g=d.parent.isTextblock?a.doc.resolve(f-1):d,h=g.parent.type.spec.isolating,m=d.pos-d.parentOffset,k=h&&g.parent.childCount===1?m===d.pos:F.atStart(c).from===f;return!p||!k||!u.type.isTextblock||u.textContent.length?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},r={...s},o={...s,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return ht()||mt()?o:r},addProseMirrorPlugins(){return[new P({key:new B("clearDocument"),appendTransaction:(t,e,n)=>{if(!(t.some(g=>g.docChanged)&&!e.doc.eq(n.doc)))return;const{empty:r,from:o,to:i}=e.selection,a=F.atStart(e.doc).from,l=F.atEnd(e.doc).to;if(r||!(o===a&&i===l)||!(n.doc.textBetween(0,n.doc.content.size," "," ").length===0))return;const d=n.tr,f=Wt({state:n,transaction:d}),{commands:u}=new _e({editor:this.editor,state:f});if(u.clearNodes(),!!d.steps.length)return d}})]}});$.create({name:"tabindex",addProseMirrorPlugins(){return[new P({key:new B("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});function j(t){return new G({find:t.find,handler:({state:e,range:n,match:s})=>{const r=T(t.getAttributes,void 0,s);if(r===!1||r===null)return null;const{tr:o}=e,i=s[s.length-1],a=s[0];if(i){const l=a.search(/\S/),c=n.from+a.indexOf(i),p=c+i.length;if(bt(n.from,n.to,e.doc).filter(u=>u.mark.type.excluded.find(h=>h===t.type&&h!==u.mark.type)).filter(u=>u.to>c).length)return null;p<n.to&&o.delete(p,n.to),c>n.from&&o.delete(n.from+l,c);const f=n.from+l+i.length;o.addMark(n.from+l,f,t.type.create(r||{})),o.removeStoredMark(t.type)}}})}function ps(t){return new G({find:t.find,handler:({state:e,range:n,match:s})=>{const r=T(t.getAttributes,void 0,s)||{},{tr:o}=e,i=n.from;let a=n.to;const l=t.type.create(r);if(s[1]){const c=s[0].lastIndexOf(s[1]);let p=i+c;p>a?p=a:a=p+s[1].length;const d=s[0][s[0].length-1];o.insertText(d,i+s[0].length-1),o.replaceWith(p,a,l)}else s[0]&&o.insert(i-1,t.type.create(r)).delete(o.mapping.map(i),o.mapping.map(a));o.scrollIntoView()}})}function dt(t){return new G({find:t.find,handler:({state:e,range:n,match:s})=>{const r=e.doc.resolve(n.from),o=T(t.getAttributes,void 0,s)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,o)}})}function A(t){return new G({find:t.find,handler:({state:e,range:n,match:s})=>{let r=t.replace,o=n.from;const i=n.to;if(s[1]){const a=s[0].lastIndexOf(s[1]);r+=s[0].slice(a+s[1].length),o+=a;const l=o-i;l>0&&(r=s[0].slice(a-l,a)+r,o=i)}e.tr.insertText(r,o,i)}})}function V(t){return new G({find:t.find,handler:({state:e,range:n,match:s,chain:r})=>{const o=T(t.getAttributes,void 0,s)||{},i=e.tr.delete(n.from,n.to),l=i.doc.resolve(n.from).blockRange(),c=l&&he(l,t.type,o);if(!c)return null;if(i.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:f}=e,{splittableMarks:u}=t.editor.extensionManager,g=f||d.$to.parentOffset&&d.$from.marks();if(g){const h=g.filter(m=>u.includes(m.type.name));i.ensureMarks(h)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";r().updateAttributes(d,o).run()}const p=i.doc.resolve(n.from-1).nodeBefore;p&&p.type===t.type&&pt(i.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(s,p))&&i.join(n.from-1)}})}class R{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=T(w(this,"addOptions",{name:this.name}))),this.storage=T(w(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new R(e)}configure(e={}){const n=this.extend();return n.options=nt(this.options,e),n.storage=T(w(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new R(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=T(w(n,"addOptions",{name:n.name})),n.storage=T(w(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:s}=e.state,r=e.state.selection.$from;if(r.pos===r.end()){const i=r.marks();if(!!!i.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=i.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&s.removeStoredMark(l),s.insertText(" ",r.pos),e.view.dispatch(s),!0}return!1}}class S{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=T(w(this,"addOptions",{name:this.name}))),this.storage=T(w(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new S(e)}configure(e={}){const n=this.extend();return n.options=nt(this.options,e),n.storage=T(w(n,"addStorage",{name:n.name,options:n.options})),n}extend(e={}){const n=new S(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=T(w(n,"addOptions",{name:n.name})),n.storage=T(w(n,"addStorage",{name:n.name,options:n.options})),n}}function z(t){return new Fe({find:t.find,handler:({state:e,range:n,match:s})=>{const r=T(t.getAttributes,void 0,s);if(r===!1||r===null)return null;const{tr:o}=e,i=s[s.length-1],a=s[0];let l=n.to;if(i){const c=a.search(/\S/),p=n.from+a.indexOf(i),d=p+i.length;if(bt(n.from,n.to,e.doc).filter(u=>u.mark.type.excluded.find(h=>h===t.type&&h!==u.mark.type)).filter(u=>u.to>p).length)return null;d<n.to&&o.delete(d,n.to),p>n.from&&o.delete(n.from+c,p),l=n.from+c+i.length,o.addMark(n.from+c,l,t.type.create(r||{})),o.removeStoredMark(t.type)}}})}function fs(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}const hs=/^\s*>\s$/,ms=S.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",M(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[V({find:hs,type:this.type})]}}),gs=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,ys=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,ks=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,bs=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,Ms=R.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",M(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[j({find:gs,type:this.type}),j({find:ks,type:this.type})]},addPasteRules(){return[z({find:ys,type:this.type}),z({find:bs,type:this.type})]}}),xs=S.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",M(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Ot=R.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["span",M(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:t,commands:e})=>{const n=Q(t,this.type);return Object.entries(n).some(([,r])=>!!r)?!0:e.unsetMark(this.name)}}}}),Rt=/^\s*([-+*])\s$/,Ts=S.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",M(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(xs.name,this.editor.getAttributes(Ot.name)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=V({find:Rt,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=V({find:Rt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Ot.name),editor:this.editor})),[t]}}),As=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,vs=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,Ss=R.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",M(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[j({find:As,type:this.type})]},addPasteRules(){return[z({find:vs,type:this.type})]}}),ws=/^```([a-z]+)?[\s\n]$/,Cs=/^~~~([a-z]+)?[\s\n]$/,Ls=S.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,o=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(i=>i.startsWith(n)).map(i=>i.replace(n,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",M(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:s,empty:r}=n;if(!r||s.parent.type!==this.type)return!1;const o=s.parentOffset===s.parent.nodeSize-2,i=s.parent.textContent.endsWith(`

`);return!o||!i?!1:t.chain().command(({tr:a})=>(a.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:s}=e,{$from:r,empty:o}=n;if(!o||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;const a=r.after();return a===void 0||s.nodeAt(a)?!1:t.commands.exitCode()}}},addInputRules(){return[dt({find:ws,type:this.type,getAttributes:t=>({language:t[1]})}),dt({find:Cs,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new P({key:new B("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),r=s?JSON.parse(s):void 0,o=r==null?void 0:r.mode;if(!n||!o)return!1;const{tr:i}=t.state;return i.replaceSelectionWith(this.type.create({language:o})),i.setSelection(I.near(i.doc.resolve(Math.max(0,i.selection.from-2)))),i.insertText(n.replace(/\r\n?/g,`
`)),i.setMeta("paste",!0),t.dispatch(i),!0}}})]}}),$s=S.create({name:"doc",topNode:!0,content:"block+"}),Hs=$.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Qt(this.options)]}}),Es=$.create({name:"gapCursor",addProseMirrorPlugins(){return[Jt()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=T(w(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),Is=S.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",M(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:s})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:r,storedMarks:o}=n;if(r.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:a}=s.extensionManager,l=o||r.$to.parentOffset&&r.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:p})=>{if(p&&l&&i){const d=l.filter(f=>a.includes(f.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Os=S.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,M(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>dt({find:new RegExp(`^(#{1,${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),Rs=$.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>Ut(t,e),redo:()=>({state:t,dispatch:e})=>Zt(t,e)}},addProseMirrorPlugins(){return[Yt(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-Z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Shift-Mod-Z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Bs=S.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",M(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{const{$to:n}=e.selection,s=t();return n.parentOffset===0?s.insertContentAt(Math.max(n.pos-2,0),{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:r,dispatch:o})=>{var i;if(o){const{$to:a}=r.selection,l=a.end();if(a.nodeAfter)a.nodeAfter.isTextblock?r.setSelection(I.create(r.doc,a.pos+1)):a.nodeAfter.isBlock?r.setSelection(ut.create(r.doc,a.pos)):r.setSelection(I.create(r.doc,a.pos));else{const c=(i=a.parent.type.contentMatch.defaultType)===null||i===void 0?void 0:i.create();c&&(r.insert(l,c),r.setSelection(I.create(r.doc,l+1)))}r.scrollIntoView()}return!0}).run()}}},addInputRules(){return[ps({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),Ps=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,Ns=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,_s=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,js=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,zs=R.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",M(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[j({find:Ps,type:this.type}),j({find:_s,type:this.type})]},addPasteRules(){return[z({find:Ns,type:this.type}),z({find:js,type:this.type})]}}),Ds=S.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",M(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Fs=S.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",M(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Bt=R.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["span",M(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:t,commands:e})=>{const n=Q(t,this.type);return Object.entries(n).some(([,r])=>!!r)?!0:e.unsetMark(this.name)}}}}),Pt=/^(\d+)\.\s$/,Ws=S.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",M(this.options.HTMLAttributes,n),0]:["ol",M(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Fs.name,this.editor.getAttributes(Bt.name)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=V({find:Pt,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=V({find:Pt,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Bt.name)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),Ks=S.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",M(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),qs=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,Vs=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,Gs=R.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",M(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){const t={};return mt()?t["Mod-Shift-s"]=()=>this.editor.commands.toggleStrike():t["Ctrl-Shift-s"]=()=>this.editor.commands.toggleStrike(),t},addInputRules(){return[j({find:qs,type:this.type})]},addPasteRules(){return[z({find:Vs,type:this.type})]}}),Qs=S.create({name:"text",group:"inline"});$.create({name:"starterKit",addExtensions(){var t,e,n,s,r,o,i,a,l,c,p,d,f,u,g,h,m,k;const y=[];return this.options.blockquote!==!1&&y.push(ms.configure((t=this.options)===null||t===void 0?void 0:t.blockquote)),this.options.bold!==!1&&y.push(Ms.configure((e=this.options)===null||e===void 0?void 0:e.bold)),this.options.bulletList!==!1&&y.push(Ts.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&y.push(Ss.configure((s=this.options)===null||s===void 0?void 0:s.code)),this.options.codeBlock!==!1&&y.push(Ls.configure((r=this.options)===null||r===void 0?void 0:r.codeBlock)),this.options.document!==!1&&y.push($s.configure((o=this.options)===null||o===void 0?void 0:o.document)),this.options.dropcursor!==!1&&y.push(Hs.configure((i=this.options)===null||i===void 0?void 0:i.dropcursor)),this.options.gapcursor!==!1&&y.push(Es.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&y.push(Is.configure((l=this.options)===null||l===void 0?void 0:l.hardBreak)),this.options.heading!==!1&&y.push(Os.configure((c=this.options)===null||c===void 0?void 0:c.heading)),this.options.history!==!1&&y.push(Rs.configure((p=this.options)===null||p===void 0?void 0:p.history)),this.options.horizontalRule!==!1&&y.push(Bs.configure((d=this.options)===null||d===void 0?void 0:d.horizontalRule)),this.options.italic!==!1&&y.push(zs.configure((f=this.options)===null||f===void 0?void 0:f.italic)),this.options.listItem!==!1&&y.push(Ds.configure((u=this.options)===null||u===void 0?void 0:u.listItem)),this.options.orderedList!==!1&&y.push(Ws.configure((g=this.options)===null||g===void 0?void 0:g.orderedList)),this.options.paragraph!==!1&&y.push(Ks.configure((h=this.options)===null||h===void 0?void 0:h.paragraph)),this.options.strike!==!1&&y.push(Gs.configure((m=this.options)===null||m===void 0?void 0:m.strike)),this.options.text!==!1&&y.push(Qs.configure((k=this.options)===null||k===void 0?void 0:k.text)),y}});$.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new P({key:new B("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,r=[];if(!n)return null;const o=t.type.createAndFill(),i=(o==null?void 0:o.sameMarkup(t))&&o.content.findDiffStart(t.content)===null;return t.descendants((a,l)=>{const c=s>=l&&s<=l+a.nodeSize,p=!a.isLeaf&&!a.childCount;if((c||!this.options.showOnlyCurrent)&&p){const d=[this.options.emptyNodeClass];i&&d.push(this.options.emptyEditorClass);const f=jt.node(l,l+a.nodeSize,{class:d.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:l,hasAnchor:c}):this.options.placeholder});r.push(f)}return this.options.includeChildren}),zt.create(t,r)}}})]}});$.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:"left"}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:t=>t.style.textAlign||this.options.defaultAlignment,renderHTML:t=>t.textAlign===this.options.defaultAlignment?{}:{style:`text-align: ${t.textAlign}`}}}}]},addCommands(){return{setTextAlign:t=>({commands:e})=>this.options.alignments.includes(t)?this.options.types.every(n=>e.updateAttributes(n,{textAlign:t})):!1,unsetTextAlign:()=>({commands:t})=>this.options.types.every(e=>t.resetAttributes(e,"textAlign"))}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}});function Nt(t,e,n,s,r,o){let i=0,a=!0,l=e.firstChild;const c=t.firstChild;for(let p=0,d=0;p<c.childCount;p+=1){const{colspan:f,colwidth:u}=c.child(p).attrs;for(let g=0;g<f;g+=1,d+=1){const h=r===d?o:u&&u[g],m=h?`${h}px`:"";i+=h||s,h||(a=!1),l?(l.style.width!==m&&(l.style.width=m),l=l.nextSibling):e.appendChild(document.createElement("col")).style.width=m}}for(;l;){const p=l.nextSibling;l.parentNode.removeChild(l),l=p}a?(n.style.width=`${i}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${i}px`)}class Js{constructor(e,n){this.node=e,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Nt(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,Nt(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){return e.type==="attributes"&&(e.target===this.table||this.colgroup.contains(e.target))}}function _t(t,e){return t.createAndFill()}function Us(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const s=t.nodes[n];s.spec.tableRole&&(e[s.spec.tableRole]=s)}),t.cached.tableNodeTypes=e,e}function Zs(t,e,n,s,r){const o=Us(t),i=[],a=[];for(let c=0;c<n;c+=1){const p=_t(o.cell);if(p&&a.push(p),s){const d=_t(o.header_cell);d&&i.push(d)}}const l=[];for(let c=0;c<e;c+=1)l.push(o.row.createChecked(null,s&&c===0?i:a));return o.table.createChecked(null,l)}function Ys(t){return t instanceof Dt}const U=({editor:t})=>{const{selection:e}=t.state;if(!Ys(e))return!1;let n=0;const s=qt(e.ranges[0].$from,o=>o.type.name==="table");return s==null||s.node.descendants(o=>{if(o.type.name==="table")return!1;["tableCell","tableHeader"].includes(o.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1};S.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:Js,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:t}){return["table",M(this.options.HTMLAttributes,t),["tbody",0]]},addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:s,dispatch:r,editor:o})=>{const i=Zs(o.schema,t,e,n);if(r){const a=s.selection.anchor+1;s.replaceSelectionWith(i).scrollIntoView().setSelection(I.near(s.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>Xt(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>te(t,e),deleteColumn:()=>({state:t,dispatch:e})=>ee(t,e),addRowBefore:()=>({state:t,dispatch:e})=>ne(t,e),addRowAfter:()=>({state:t,dispatch:e})=>se(t,e),deleteRow:()=>({state:t,dispatch:e})=>re(t,e),deleteTable:()=>({state:t,dispatch:e})=>oe(t,e),mergeCells:()=>({state:t,dispatch:e})=>At(t,e),splitCell:()=>({state:t,dispatch:e})=>vt(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>St("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>St("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>ie(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>At(t,e)?!0:vt(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:s})=>ae(t,e)(n,s),goToNextCell:()=>({state:t,dispatch:e})=>wt(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>wt(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&le(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const s=Dt.create(e.doc,t.anchorCell,t.headCell);e.setSelection(s)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:U,"Mod-Backspace":U,Delete:U,"Mod-Delete":U}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[ce({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],de({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:T(w(t,"tableRole",e))}}});S.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",M(this.options.HTMLAttributes,t),0]}});S.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?[parseInt(e,10)]:null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",M(this.options.HTMLAttributes,t),0]}});S.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",M(this.options.HTMLAttributes,t),0]}});function Xs(t){return new P({key:new B("autolink"),appendTransaction:(e,n,s)=>{const r=e.some(c=>c.docChanged)&&!n.doc.eq(s.doc),o=e.some(c=>c.getMeta("preventAutolink"));if(!r||o)return;const{tr:i}=s,a=Nn(n.doc,[...e]);if(Kn(a).forEach(({newRange:c})=>{const p=jn(s.doc,c,u=>u.isTextblock);let d,f;if(p.length>1?(d=p[0],f=s.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ")):p.length&&s.doc.textBetween(c.from,c.to," "," ").endsWith(" ")&&(d=p[0],f=s.doc.textBetween(d.pos,c.to,void 0," ")),d&&f){const u=f.split(" ").filter(m=>m!=="");if(u.length<=0)return!1;const g=u[u.length-1],h=d.pos+f.lastIndexOf(g);if(!g)return!1;lt(g).filter(m=>m.isLink).map(m=>({...m,from:h+m.start+1,to:h+m.end+1})).filter(m=>s.schema.marks.code?!s.doc.rangeHasMark(m.from,m.to,s.schema.marks.code):!0).filter(m=>t.validate?t.validate(m.value):!0).forEach(m=>{bt(m.from,m.to,s.doc).some(k=>k.mark.type===t.type)||i.addMark(m.from,m.to,t.type.create({href:m.href}))})}}),!!i.steps.length)return i}})}function tr(t){return new P({key:new B("handleClickLink"),props:{handleClick:(e,n,s)=>{var r,o;if(s.button!==0||s.target.nodeName!=="A")return!1;const a=Dn(e.state,t.type.name),l=s.target,c=(r=l==null?void 0:l.href)!==null&&r!==void 0?r:a.href,p=(o=l==null?void 0:l.target)!==null&&o!==void 0?o:a.target;return l&&c?(e.editable&&window.open(c,p),!0):!1}}})}function er(t){return new P({key:new B("handlePasteLink"),props:{handlePaste:(e,n,s)=>{var r,o;const{state:i}=e,{selection:a}=i;if(i.doc.resolve(a.from).parent.type.spec.code)return!1;let l="";s.content.forEach(y=>{l+=y.textContent});let c=!1;if(s.content.descendants(y=>{y.marks.some(x=>x.type.name===t.type.name)&&(c=!0)}),c)return;const p=lt(l).find(y=>y.isLink&&y.value===l);if(!a.empty&&t.linkOnPaste){const y=(p==null?void 0:p.href)||null;if(y)return t.editor.commands.setMark(t.type,{href:y}),!0}const d=((r=s.content.firstChild)===null||r===void 0?void 0:r.type.name)==="text",f=(o=s.content.firstChild)===null||o===void 0?void 0:o.marks.some(y=>y.type.name===t.type.name);if(d&&f||!t.linkOnPaste)return!1;if(p&&a.empty)return t.editor.commands.insertContent(`<a href="${p.href}">${p.href}</a>`),!0;const{tr:u}=i;let g=!1;a.empty||(g=!0,u.delete(a.from,a.to));let h=a.from,m=[];s.content.forEach(y=>{m=lt(y.textContent),u.insert(h-1,y),m.length>0&&(g=!1,m.forEach(x=>{const C=h+x.start,v=h+x.end;u.doc.rangeHasMark(C,v,t.type)||u.addMark(C,v,t.type.create({href:x.href}))})),h+=y.nodeSize});const k=m.length>0;return u.docChanged&&!g&&k?(t.editor.view.dispatch(u),!0):!1}}})}R.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(t=>{if(typeof t=="string"){Ct(t);return}Ct(t.scheme,t.optionalSlashes)})},onDestroy(){ue()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}},addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:'a[href]:not([href *= "javascript:" i])'}]},renderHTML({HTMLAttributes:t}){return["a",M(this.options.HTMLAttributes,t),0]},addCommands(){return{setLink:t=>({chain:e})=>e().setMark(this.name,t).setMeta("preventAutolink",!0).run(),toggleLink:t=>({chain:e})=>e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addProseMirrorPlugins(){const t=[];return this.options.autolink&&t.push(Xs({type:this.type,validate:this.options.validate})),this.options.openOnClick&&t.push(tr({type:this.type})),t.push(er({editor:this.editor,type:this.type,linkOnPaste:this.options.linkOnPaste})),t}});const nr=t=>A({find:/--$/,replace:t!=null?t:"—"}),sr=t=>A({find:/\.\.\.$/,replace:t!=null?t:"…"}),rr=t=>A({find:/(?:^|[\s{[(<'"\u2018\u201C])(")$/,replace:t!=null?t:"“"}),or=t=>A({find:/"$/,replace:t!=null?t:"”"}),ir=t=>A({find:/(?:^|[\s{[(<'"\u2018\u201C])(')$/,replace:t!=null?t:"‘"}),ar=t=>A({find:/'$/,replace:t!=null?t:"’"}),lr=t=>A({find:/<-$/,replace:t!=null?t:"←"}),cr=t=>A({find:/->$/,replace:t!=null?t:"→"}),dr=t=>A({find:/\(c\)$/,replace:t!=null?t:"©"}),ur=t=>A({find:/\(tm\)$/,replace:t!=null?t:"™"}),pr=t=>A({find:/\(sm\)$/,replace:t!=null?t:"℠"}),fr=t=>A({find:/\(r\)$/,replace:t!=null?t:"®"}),hr=t=>A({find:/(?:^|\s)(1\/2)$/,replace:t!=null?t:"½"}),mr=t=>A({find:/\+\/-$/,replace:t!=null?t:"±"}),gr=t=>A({find:/!=$/,replace:t!=null?t:"≠"}),yr=t=>A({find:/<<$/,replace:t!=null?t:"«"}),kr=t=>A({find:/>>$/,replace:t!=null?t:"»"}),br=t=>A({find:/\d+\s?([*x])\s?\d+$/,replace:t!=null?t:"×"}),Mr=t=>A({find:/\^2$/,replace:t!=null?t:"²"}),xr=t=>A({find:/\^3$/,replace:t!=null?t:"³"}),Tr=t=>A({find:/(?:^|\s)(1\/4)$/,replace:t!=null?t:"¼"}),Ar=t=>A({find:/(?:^|\s)(3\/4)$/,replace:t!=null?t:"¾"});$.create({name:"typography",addInputRules(){const t=[];return this.options.emDash!==!1&&t.push(nr(this.options.emDash)),this.options.ellipsis!==!1&&t.push(sr(this.options.ellipsis)),this.options.openDoubleQuote!==!1&&t.push(rr(this.options.openDoubleQuote)),this.options.closeDoubleQuote!==!1&&t.push(or(this.options.closeDoubleQuote)),this.options.openSingleQuote!==!1&&t.push(ir(this.options.openSingleQuote)),this.options.closeSingleQuote!==!1&&t.push(ar(this.options.closeSingleQuote)),this.options.leftArrow!==!1&&t.push(lr(this.options.leftArrow)),this.options.rightArrow!==!1&&t.push(cr(this.options.rightArrow)),this.options.copyright!==!1&&t.push(dr(this.options.copyright)),this.options.trademark!==!1&&t.push(ur(this.options.trademark)),this.options.servicemark!==!1&&t.push(pr(this.options.servicemark)),this.options.registeredTrademark!==!1&&t.push(fr(this.options.registeredTrademark)),this.options.oneHalf!==!1&&t.push(hr(this.options.oneHalf)),this.options.plusMinus!==!1&&t.push(mr(this.options.plusMinus)),this.options.notEqual!==!1&&t.push(gr(this.options.notEqual)),this.options.laquo!==!1&&t.push(yr(this.options.laquo)),this.options.raquo!==!1&&t.push(kr(this.options.raquo)),this.options.multiplication!==!1&&t.push(br(this.options.multiplication)),this.options.superscriptTwo!==!1&&t.push(Mr(this.options.superscriptTwo)),this.options.superscriptThree!==!1&&t.push(xr(this.options.superscriptThree)),this.options.oneQuarter!==!1&&t.push(Tr(this.options.oneQuarter)),this.options.threeQuarters!==!1&&t.push(Ar(this.options.threeQuarters)),t}});R.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:t=>t.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["span",M(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:t,commands:e})=>{const n=Q(t,this.type);return Object.entries(n).some(([,r])=>!!r)?!0:e.unsetMark(this.name)}}}});const vr=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,Sr=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g;R.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",M(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[j({find:vr,type:this.type})]},addPasteRules(){return[z({find:Sr,type:this.type})]}});$.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;return(e=t.style.color)===null||e===void 0?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}});function wr(t){var e;const{char:n,allowSpaces:s,allowedPrefixes:r,startOfLine:o,$position:i}=t,a=fs(n),l=new RegExp(`\\s${a}$`),c=o?"^":"",p=s?new RegExp(`${c}${a}.*?(?=\\s${a}|$)`,"gm"):new RegExp(`${c}(?:^)?${a}[^\\s${a}]*`,"gm"),d=((e=i.nodeBefore)===null||e===void 0?void 0:e.isText)&&i.nodeBefore.text;if(!d)return null;const f=i.pos-d.length,u=Array.from(d.matchAll(p)).pop();if(!u||u.input===void 0||u.index===void 0)return null;const g=u.input.slice(Math.max(0,u.index-1),u.index),h=new RegExp(`^[${r==null?void 0:r.join("")}\0]?$`).test(g);if(r!==null&&!h)return null;const m=f+u.index;let k=m+u[0].length;return s&&l.test(d.slice(k-1,k+1))&&(u[0]+=" ",k+=1),m<i.pos&&k>=i.pos?{range:{from:m,to:k},query:u[0].slice(n.length),text:u[0]}:null}const Cr=new B("suggestion");function Lr({pluginKey:t=Cr,editor:e,char:n="@",allowSpaces:s=!1,allowedPrefixes:r=[" "],startOfLine:o=!1,decorationTag:i="span",decorationClass:a="suggestion",command:l=()=>null,items:c=()=>[],render:p=()=>({}),allow:d=()=>!0}){let f;const u=p==null?void 0:p(),g=new P({key:t,view(){return{update:async(h,m)=>{var k,y,x,C,v,H,E;const b=(k=this.key)===null||k===void 0?void 0:k.getState(m),O=(y=this.key)===null||y===void 0?void 0:y.getState(h.state),W=b.active&&O.active&&b.range.from!==O.range.from,Mt=!b.active&&O.active,xt=b.active&&!O.active,Vt=!Mt&&!xt&&b.query!==O.query,K=Mt||W,J=Vt&&!W,st=xt||W;if(!K&&!J&&!st)return;const D=st&&!K?b:O,Tt=h.dom.querySelector(`[data-decoration-id="${D.decorationId}"]`);f={editor:e,range:D.range,query:D.query,text:D.text,items:[],command:q=>{l({editor:e,range:D.range,props:q})},decorationNode:Tt,clientRect:Tt?()=>{var q;const{decorationId:Gt}=(q=this.key)===null||q===void 0?void 0:q.getState(e.state),rt=h.dom.querySelector(`[data-decoration-id="${Gt}"]`);return(rt==null?void 0:rt.getBoundingClientRect())||null}:null},K&&((x=u==null?void 0:u.onBeforeStart)===null||x===void 0||x.call(u,f)),J&&((C=u==null?void 0:u.onBeforeUpdate)===null||C===void 0||C.call(u,f)),(J||K)&&(f.items=await c({editor:e,query:D.query})),st&&((v=u==null?void 0:u.onExit)===null||v===void 0||v.call(u,f)),J&&((H=u==null?void 0:u.onUpdate)===null||H===void 0||H.call(u,f)),K&&((E=u==null?void 0:u.onStart)===null||E===void 0||E.call(u,f))},destroy:()=>{var h;f&&((h=u==null?void 0:u.onExit)===null||h===void 0||h.call(u,f))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(h,m,k,y){const{isEditable:x}=e,{composing:C}=e.view,{selection:v}=h,{empty:H,from:E}=v,b={...m};if(b.composing=C,x&&(H||e.view.composing)){(E<m.range.from||E>m.range.to)&&!C&&!m.composing&&(b.active=!1);const O=wr({char:n,allowSpaces:s,allowedPrefixes:r,startOfLine:o,$position:v.$from}),W=`id_${Math.floor(Math.random()*4294967295)}`;O&&d({editor:e,state:y,range:O.range})?(b.active=!0,b.decorationId=m.decorationId?m.decorationId:W,b.range=O.range,b.query=O.query,b.text=O.text):b.active=!1}else b.active=!1;return b.active||(b.decorationId=null,b.range={from:0,to:0},b.query=null,b.text=null),b}},props:{handleKeyDown(h,m){var k;const{active:y,range:x}=g.getState(h.state);return y&&((k=u==null?void 0:u.onKeyDown)===null||k===void 0?void 0:k.call(u,{view:h,event:m,range:x}))||!1},decorations(h){const{active:m,range:k,decorationId:y}=g.getState(h);return m?zt.create(h.doc,[jt.inline(k.from,k.to,{nodeName:i,class:a,"data-decoration-id":y})]):null}}});return g}const $r=new B("mention");S.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderLabel({options:t,node:e}){var n;return`${t.suggestion.char}${(n=e.attrs.label)!==null&&n!==void 0?n:e.attrs.id}`},suggestion:{char:"@",pluginKey:$r,command:({editor:t,range:e,props:n})=>{var s,r;const o=t.view.state.selection.$to.nodeAfter;((s=o==null?void 0:o.text)===null||s===void 0?void 0:s.startsWith(" "))&&(e.to+=1),t.chain().focus().insertContentAt(e,[{type:this.name,attrs:n},{type:"text",text:" "}]).run(),(r=window.getSelection())===null||r===void 0||r.collapseToEnd()},allow:({state:t,range:e})=>{const n=t.doc.resolve(e.from),s=t.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(s)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:t=>t.getAttribute("data-id"),renderHTML:t=>t.id?{"data-id":t.id}:{}},label:{default:null,parseHTML:t=>t.getAttribute("data-label"),renderHTML:t=>t.label?{"data-label":t.label}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:e}){return["span",M({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:t})]},renderText({node:t}){return this.options.renderLabel({options:this.options,node:t})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:t,state:e})=>{let n=!1;const{selection:s}=e,{empty:r,anchor:o}=s;return r?(e.doc.nodesBetween(o-1,o,(i,a)=>{if(i.type.name===this.name)return n=!0,t.insertText(this.options.suggestion.char||"",a,a+i.nodeSize),!1}),n):!1})}},addProseMirrorPlugins(){return[Lr({editor:this.editor,...this.options.suggestion})]}});export{S as N,M as m,ps as n};
