import{T as k,N as h,S as J,A as tt}from"./prosemirror-state-DgsmxDjm.js";import{S as O,b as Ie,F as z,D as nt}from"./prosemirror-model-C_7RDaDb.js";import{d as rt}from"./prosemirror-transform-DoYUQK9o.js";const j=function(e){for(var n=0;;n++)if(e=e.previousSibling,!e)return n},$e=function(e,n,t,r){return t&&(Ce(e,n,t,r,-1)||Ce(e,n,t,r,1))},ot=/^(img|br|input|textarea|hr)$/i;function Ce(e,n,t,r,o){for(;;){if(e==t&&n==r)return!0;if(n==(o<0?0:G(e))){let l=e.parentNode;if(!l||l.nodeType!=1||st(e)||ot.test(e.nodeName)||e.contentEditable=="false")return!1;n=j(e)+(o<0?0:1),e=l}else if(e.nodeType==1){if(e=e.childNodes[n+(o<0?-1:0)],e.contentEditable=="false")return!1;n=o<0?G(e):0}else return!1}}function G(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function lt(e,n,t){for(let r=n==0,o=n==G(e);r||o;){if(e==t)return!0;let l=j(e);if(e=e.parentNode,!e)return!1;r=r&&l==0,o=o&&l==G(e)}}function st(e){let n;for(let t=e;t&&!(n=t.pmViewDesc);t=t.parentNode);return n&&n.node&&n.node.isBlock&&(n.dom==e||n.contentDOM==e)}const Ke=function(e){return e.focusNode&&$e(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function ze(e,n){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=e,t.key=t.code=n,t}const M=typeof navigator!="undefined"?navigator:null,Se=typeof document!="undefined"?document:null,P=M&&M.userAgent||"",re=/Edge\/(\d+)/.exec(P),Ve=/MSIE \d/.exec(P),oe=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(P),U=!!(Ve||oe||re),Le=Ve?document.documentMode:oe?+oe[1]:re?+re[1]:0,v=!U&&/gecko\/(\d+)/i.test(P);v&&+(/Firefox\/(\d+)/.exec(P)||[0,0])[1];const le=!U&&/Chrome\/(\d+)/.exec(P),q=!!le,it=le?+le[1]:0,V=!U&&!!M&&/Apple Computer/.test(M.vendor),fe=V&&(/Mobile\/\w+/.test(P)||!!M&&M.maxTouchPoints>2),C=fe||(M?/Mac/.test(M.platform):!1),X=/Android \d/.test(P),ue=!!Se&&"webkitFontSmoothing"in Se.documentElement.style,at=ue?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function ct(e,n=null){let t=e.domSelectionRange(),r=e.state.doc;if(!t.focusNode)return null;let o=e.docView.nearestDesc(t.focusNode),l=o&&o.size==0,s=e.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(s<0)return null;let i=r.resolve(s),a,c;if(Ke(t)){for(a=i;o&&!o.node;)o=o.parent;let f=o.node;if(o&&f.isAtom&&h.isSelectable(f)&&o.parent&&!(f.isInline&&lt(t.focusNode,t.focusOffset,o.dom))){let u=o.posBefore;c=new h(s==u?i:r.resolve(u))}}else{let f=e.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(f<0)return null;a=r.resolve(f)}if(!c){let f=n=="pointer"||e.state.selection.head<i.pos&&!l?1:-1;c=Be(e,a,i,f)}return c}function Fe(e){return e.editable?e.hasFocus():pt(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function de(e,n=!1){let t=e.state.selection;if(dt(e,t),!!Fe(e)){if(!n&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&q){let r=e.domSelectionRange(),o=e.domObserver.currentSelection;if(r.anchorNode&&o.anchorNode&&$e(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset)){e.input.mouseDown.delayedSelectionSync=!0,e.domObserver.setCurSelection();return}}if(e.domObserver.disconnectSelection(),e.cursorWrapper)ut(e);else{let{anchor:r,head:o}=t,l,s;De&&!(t instanceof k)&&(t.$from.parent.inlineContent||(l=Ne(e,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(s=Ne(e,t.to))),e.docView.setSelection(r,o,e.root,n),De&&(l&&ke(l),s&&ke(s)),t.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&ft(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const De=V||q&&it<63;function Ne(e,n){let{node:t,offset:r}=e.docView.domFromPos(n,0),o=r<t.childNodes.length?t.childNodes[r]:null,l=r?t.childNodes[r-1]:null;if(V&&o&&o.contentEditable=="false")return ee(o);if((!o||o.contentEditable=="false")&&(!l||l.contentEditable=="false")){if(o)return ee(o);if(l)return ee(l)}}function ee(e){return e.contentEditable="true",V&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function ke(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function ft(e){let n=e.dom.ownerDocument;n.removeEventListener("selectionchange",e.input.hideSelectionGuard);let t=e.domSelectionRange(),r=t.anchorNode,o=t.anchorOffset;n.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{(t.anchorNode!=r||t.anchorOffset!=o)&&(n.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout(()=>{(!Fe(e)||e.state.selection.visible)&&e.dom.classList.remove("ProseMirror-hideselection")},20))})}function ut(e){let n=e.domSelection(),t=document.createRange(),r=e.cursorWrapper.dom,o=r.nodeName=="IMG";o?t.setEnd(r.parentNode,j(r)+1):t.setEnd(r,0),t.collapse(!1),n.removeAllRanges(),n.addRange(t),!o&&!e.state.selection.visible&&U&&Le<=11&&(r.disabled=!0,r.disabled=!1)}function dt(e,n){if(n instanceof h){let t=e.docView.descAt(n.from);t!=e.lastSelectedViewDesc&&(Te(e),t&&t.selectNode(),e.lastSelectedViewDesc=t)}else Te(e)}function Te(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function Be(e,n,t,r){return e.someProp("createSelectionBetween",o=>o(e,n,t))||k.between(n,t,r)}function pt(e){let n=e.domSelectionRange();if(!n.anchorNode)return!1;try{return e.dom.contains(n.anchorNode.nodeType==3?n.anchorNode.parentNode:n.anchorNode)&&(e.editable||e.dom.contains(n.focusNode.nodeType==3?n.focusNode.parentNode:n.focusNode))}catch(t){return!1}}function se(e,n){let{$anchor:t,$head:r}=e.selection,o=n>0?t.max(r):t.min(r),l=o.parent.inlineContent?o.depth?e.doc.resolve(n>0?o.after():o.before()):null:o;return l&&J.findFrom(l,n)}function R(e,n){return e.dispatch(e.state.tr.setSelection(n).scrollIntoView()),!0}function xe(e,n,t){let r=e.state.selection;if(r instanceof k){if(!r.empty||t.indexOf("s")>-1)return!1;if(e.endOfTextblock(n>0?"right":"left")){let o=se(e.state,n);return o&&o instanceof h?R(e,o):!1}else if(!(C&&t.indexOf("m")>-1)){let o=r.$head,l=o.textOffset?null:n<0?o.nodeBefore:o.nodeAfter,s;if(!l||l.isText)return!1;let i=n<0?o.pos-l.nodeSize:o.pos;return l.isAtom||(s=e.docView.descAt(i))&&!s.contentDOM?h.isSelectable(l)?R(e,new h(n<0?e.state.doc.resolve(o.pos-l.nodeSize):o)):ue?R(e,new k(e.state.doc.resolve(n<0?i:i+l.nodeSize))):!1:!1}}else{if(r instanceof h&&r.node.isInline)return R(e,new k(n>0?r.$to:r.$from));{let o=se(e.state,n);return o?R(e,o):!1}}}function Q(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}function H(e){let n=e.pmViewDesc;return n&&n.size==0&&(e.nextSibling||e.nodeName!="BR")}function te(e){let n=e.domSelectionRange(),t=n.focusNode,r=n.focusOffset;if(!t)return;let o,l,s=!1;for(v&&t.nodeType==1&&r<Q(t)&&H(t.childNodes[r])&&(s=!0);;)if(r>0){if(t.nodeType!=1)break;{let i=t.childNodes[r-1];if(H(i))o=t,l=--r;else if(i.nodeType==3)t=i,r=t.nodeValue.length;else break}}else{if(qe(t))break;{let i=t.previousSibling;for(;i&&H(i);)o=t.parentNode,l=j(i),i=i.previousSibling;if(i)t=i,r=Q(t);else{if(t=t.parentNode,t==e.dom)break;r=0}}}s?ie(e,t,r):o&&ie(e,o,l)}function ne(e){let n=e.domSelectionRange(),t=n.focusNode,r=n.focusOffset;if(!t)return;let o=Q(t),l,s;for(;;)if(r<o){if(t.nodeType!=1)break;let i=t.childNodes[r];if(H(i))l=t,s=++r;else break}else{if(qe(t))break;{let i=t.nextSibling;for(;i&&H(i);)l=i.parentNode,s=j(i)+1,i=i.nextSibling;if(i)t=i,r=0,o=Q(t);else{if(t=t.parentNode,t==e.dom)break;r=o=0}}}l&&ie(e,l,s)}function qe(e){let n=e.pmViewDesc;return n&&n.node&&n.node.isBlock}function ie(e,n,t){let r=e.domSelection();if(Ke(r)){let l=document.createRange();l.setEnd(n,t),l.setStart(n,t),r.removeAllRanges(),r.addRange(l)}else r.extend&&r.extend(n,t);e.domObserver.setCurSelection();let{state:o}=e;setTimeout(()=>{e.state==o&&de(e)},50)}function Ee(e,n,t){let r=e.state.selection;if(r instanceof k&&!r.empty||t.indexOf("s")>-1||C&&t.indexOf("m")>-1)return!1;let{$from:o,$to:l}=r;if(!o.parent.inlineContent||e.endOfTextblock(n<0?"up":"down")){let s=se(e.state,n);if(s&&s instanceof h)return R(e,s)}if(!o.parent.inlineContent){let s=n<0?o:l,i=r instanceof tt?J.near(s,n):J.findFrom(s,n);return i?R(e,i):!1}return!1}function Oe(e,n){if(!(e.state.selection instanceof k))return!0;let{$head:t,$anchor:r,empty:o}=e.state.selection;if(!t.sameParent(r))return!0;if(!o)return!1;if(e.endOfTextblock(n>0?"forward":"backward"))return!0;let l=!t.textOffset&&(n<0?t.nodeBefore:t.nodeAfter);if(l&&!l.isText){let s=e.state.tr;return n<0?s.delete(t.pos-l.nodeSize,t.pos):s.delete(t.pos,t.pos+l.nodeSize),e.dispatch(s),!0}return!1}function Ae(e,n,t){e.domObserver.stop(),n.contentEditable=t,e.domObserver.start()}function ht(e){if(!V||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:n,focusOffset:t}=e.domSelectionRange();if(n&&n.nodeType==1&&t==0&&n.firstChild&&n.firstChild.contentEditable=="false"){let r=n.firstChild;Ae(e,r,"true"),setTimeout(()=>Ae(e,r,"false"),20)}return!1}function mt(e){let n="";return e.ctrlKey&&(n+="c"),e.metaKey&&(n+="m"),e.altKey&&(n+="a"),e.shiftKey&&(n+="s"),n}function gt(e,n){let t=n.keyCode,r=mt(n);return t==8||C&&t==72&&r=="c"?Oe(e,-1)||te(e):t==46||C&&t==68&&r=="c"?Oe(e,1)||ne(e):t==13||t==27?!0:t==37||C&&t==66&&r=="c"?xe(e,-1,r)||te(e):t==39||C&&t==70&&r=="c"?xe(e,1,r)||ne(e):t==38||C&&t==80&&r=="c"?Ee(e,-1,r)||te(e):t==40||C&&t==78&&r=="c"?ht(e)||Ee(e,1,r)||ne(e):r==(C?"m":"c")&&(t==66||t==73||t==89||t==90)}function He(e,n){e.someProp("transformCopied",d=>{n=d(n,e)});let t=[],{content:r,openStart:o,openEnd:l}=n;for(;o>1&&l>1&&r.childCount==1&&r.firstChild.childCount==1;){o--,l--;let d=r.firstChild;t.push(d.type.name,d.attrs!=d.type.defaultAttrs?d.attrs:null),r=d.content}let s=e.someProp("clipboardSerializer")||Ie.fromSchema(e.state.schema),i=Je(),a=i.createElement("div");a.appendChild(s.serializeFragment(r,{document:i}));let c=a.firstChild,f,u=0;for(;c&&c.nodeType==1&&(f=Ye[c.nodeName.toLowerCase()]);){for(let d=f.length-1;d>=0;d--){let g=i.createElement(f[d]);for(;a.firstChild;)g.appendChild(a.firstChild);a.appendChild(g),u++}c=a.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${o} ${l}${u?` -${u}`:""} ${JSON.stringify(t)}`);let p=e.someProp("clipboardTextSerializer",d=>d(n,e))||n.content.textBetween(0,n.content.size,`

`);return{dom:a,text:p}}function We(e,n,t,r,o){let l=o.parent.type.spec.code,s,i;if(!t&&!n)return null;let a=n&&(r||l||!t);if(a){if(e.someProp("transformPastedText",p=>{n=p(n,l||r,e)}),l)return n?new O(z.from(e.state.schema.text(n.replace(/\r\n?/g,`
`))),0,0):O.empty;let u=e.someProp("clipboardTextParser",p=>p(n,o,r,e));if(u)i=u;else{let p=o.marks(),{schema:d}=e.state,g=Ie.fromSchema(d);s=document.createElement("div"),n.split(/(?:\r\n?|\n)+/).forEach(x=>{let S=s.appendChild(document.createElement("p"));x&&S.appendChild(g.serializeNode(d.text(x,p)))})}}else e.someProp("transformPastedHTML",u=>{t=u(t,e)}),s=Ct(t),ue&&St(s);let c=s&&s.querySelector("[data-pm-slice]"),f=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(f&&f[3])for(let u=+f[3];u>0;u--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(i||(i=(e.someProp("clipboardParser")||e.someProp("domParser")||nt.fromSchema(e.state.schema)).parseSlice(s,{preserveWhitespace:!!(a||f),context:o,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!bt.test(p.parentNode.nodeName)?{ignore:!0}:null}})),f)i=Dt(Me(i,+f[1],+f[2]),f[4]);else if(i=O.maxOpen(yt(i.content,o),!0),i.openStart||i.openEnd){let u=0,p=0;for(let d=i.content.firstChild;u<i.openStart&&!d.type.spec.isolating;u++,d=d.firstChild);for(let d=i.content.lastChild;p<i.openEnd&&!d.type.spec.isolating;p++,d=d.lastChild);i=Me(i,u,p)}return e.someProp("transformPasted",u=>{i=u(i,e)}),i}const bt=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function yt(e,n){if(e.childCount<2)return e;for(let t=n.depth;t>=0;t--){let o=n.node(t).contentMatchAt(n.index(t)),l,s=[];if(e.forEach(i=>{if(!s)return;let a=o.findWrapping(i.type),c;if(!a)return s=null;if(c=s.length&&l.length&&Ue(a,l,i,s[s.length-1],0))s[s.length-1]=c;else{s.length&&(s[s.length-1]=Xe(s[s.length-1],l.length));let f=je(i,a);s.push(f),o=o.matchType(f.type),l=a}}),s)return z.from(s)}return e}function je(e,n,t=0){for(let r=n.length-1;r>=t;r--)e=n[r].create(null,z.from(e));return e}function Ue(e,n,t,r,o){if(o<e.length&&o<n.length&&e[o]==n[o]){let l=Ue(e,n,t,r.lastChild,o+1);if(l)return r.copy(r.content.replaceChild(r.childCount-1,l));if(r.contentMatchAt(r.childCount).matchType(o==e.length-1?t.type:e[o+1]))return r.copy(r.content.append(z.from(je(t,e,o+1))))}}function Xe(e,n){if(n==0)return e;let t=e.content.replaceChild(e.childCount-1,Xe(e.lastChild,n-1)),r=e.contentMatchAt(e.childCount).fillBefore(z.empty,!0);return e.copy(t.append(r))}function ae(e,n,t,r,o,l){let s=n<0?e.firstChild:e.lastChild,i=s.content;return o<r-1&&(i=ae(i,n,t,r,o+1,l)),o>=t&&(i=n<0?s.contentMatchAt(0).fillBefore(i,e.childCount>1||l<=o).append(i):i.append(s.contentMatchAt(s.childCount).fillBefore(z.empty,!0))),e.replaceChild(n<0?0:e.childCount-1,s.copy(i))}function Me(e,n,t){return n<e.openStart&&(e=new O(ae(e.content,-1,n,e.openStart,0,e.openEnd),n,e.openEnd)),t<e.openEnd&&(e=new O(ae(e.content,1,t,e.openEnd,0,0),e.openStart,t)),e}const Ye={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Pe=null;function Je(){return Pe||(Pe=document.implementation.createHTMLDocument("title"))}function Ct(e){let n=/^(\s*<meta [^>]*>)*/.exec(e);n&&(e=e.slice(n[0].length));let t=Je().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(e),o;if((o=r&&Ye[r[1].toLowerCase()])&&(e=o.map(l=>"<"+l+">").join("")+e+o.map(l=>"</"+l+">").reverse().join("")),t.innerHTML=e,o)for(let l=0;l<o.length;l++)t=t.querySelector(o[l])||t;return t}function St(e){let n=e.querySelectorAll(q?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<n.length;t++){let r=n[t];r.childNodes.length==1&&r.textContent=="Â "&&r.parentNode&&r.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),r)}}function Dt(e,n){if(!e.size)return e;let t=e.content.firstChild.type.schema,r;try{r=JSON.parse(n)}catch(i){return e}let{content:o,openStart:l,openEnd:s}=e;for(let i=r.length-2;i>=0;i-=2){let a=t.nodes[r[i]];if(!a||a.hasRequiredAttrs())break;o=z.from(a.create(r[i+1],o)),l++,s++}return new O(o,l,s)}const N={},y={};function E(e,n){e.input.lastSelectionOrigin=n,e.input.lastSelectionTime=Date.now()}y.keydown=(e,n)=>{let t=n;if(e.input.shiftKey=t.keyCode==16||t.shiftKey,!Qe(e,t)&&(e.input.lastKeyCode=t.keyCode,e.input.lastKeyCodeTime=Date.now(),!(X&&q&&t.keyCode==13)))if(t.keyCode!=229&&e.domObserver.forceFlush(),fe&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let r=Date.now();e.input.lastIOSEnter=r,e.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{e.input.lastIOSEnter==r&&(e.someProp("handleKeyDown",o=>o(e,ze(13,"Enter"))),e.input.lastIOSEnter=0)},200)}else e.someProp("handleKeyDown",r=>r(e,t))||gt(e,t)?t.preventDefault():E(e,"key")};y.keyup=(e,n)=>{n.keyCode==16&&(e.input.shiftKey=!1)};y.keypress=(e,n)=>{let t=n;if(Qe(e,t)||!t.charCode||t.ctrlKey&&!t.altKey||C&&t.metaKey)return;if(e.someProp("handleKeyPress",o=>o(e,t))){t.preventDefault();return}let r=e.state.selection;if(!(r instanceof k)||!r.$from.sameParent(r.$to)){let o=String.fromCharCode(t.charCode);!/[\r\n]/.test(o)&&!e.someProp("handleTextInput",l=>l(e,r.$from.pos,r.$to.pos,o))&&e.dispatch(e.state.tr.insertText(o).scrollIntoView()),t.preventDefault()}};function w(e){return{left:e.clientX,top:e.clientY}}function Nt(e,n){let t=n.x-e.clientX,r=n.y-e.clientY;return t*t+r*r<100}function pe(e,n,t,r,o){if(r==-1)return!1;let l=e.state.doc.resolve(r);for(let s=l.depth+1;s>0;s--)if(e.someProp(n,i=>s>l.depth?i(e,t,l.nodeAfter,l.before(s),o,!0):i(e,t,l.node(s),l.before(s),o,!1)))return!0;return!1}function F(e,n,t){e.focused||e.focus();let r=e.state.tr.setSelection(n);r.setMeta("pointer",!0),e.dispatch(r)}function kt(e,n){if(n==-1)return!1;let t=e.state.doc.resolve(n),r=t.nodeAfter;return r&&r.isAtom&&h.isSelectable(r)?(F(e,new h(t)),!0):!1}function Tt(e,n){if(n==-1)return!1;let t=e.state.selection,r,o;t instanceof h&&(r=t.node);let l=e.state.doc.resolve(n);for(let s=l.depth+1;s>0;s--){let i=s>l.depth?l.nodeAfter:l.node(s);if(h.isSelectable(i)){r&&t.$from.depth>0&&s>=t.$from.depth&&l.before(t.$from.depth+1)==t.$from.pos?o=l.before(t.$from.depth):o=l.before(s);break}}return o!=null?(F(e,h.create(e.state.doc,o)),!0):!1}function xt(e,n,t,r,o){return pe(e,"handleClickOn",n,t,r)||e.someProp("handleClick",l=>l(e,n,r))||(o?Tt(e,t):kt(e,t))}function Et(e,n,t,r){return pe(e,"handleDoubleClickOn",n,t,r)||e.someProp("handleDoubleClick",o=>o(e,n,r))}function Ot(e,n,t,r){return pe(e,"handleTripleClickOn",n,t,r)||e.someProp("handleTripleClick",o=>o(e,n,r))||At(e,t,r)}function At(e,n,t){if(t.button!=0)return!1;let r=e.state.doc;if(n==-1)return r.inlineContent?(F(e,k.create(r,0,r.content.size)),!0):!1;let o=r.resolve(n);for(let l=o.depth+1;l>0;l--){let s=l>o.depth?o.nodeAfter:o.node(l),i=o.before(l);if(s.inlineContent)F(e,k.create(r,i+1,i+1+s.content.size));else if(h.isSelectable(s))F(e,h.create(r,i));else continue;return!0}}function he(e){return Z(e)}const Ge=C?"metaKey":"ctrlKey";N.mousedown=(e,n)=>{let t=n;e.input.shiftKey=t.shiftKey;let r=he(e),o=Date.now(),l="singleClick";o-e.input.lastClick.time<500&&Nt(t,e.input.lastClick)&&!t[Ge]&&(e.input.lastClick.type=="singleClick"?l="doubleClick":e.input.lastClick.type=="doubleClick"&&(l="tripleClick")),e.input.lastClick={time:o,x:t.clientX,y:t.clientY,type:l};let s=e.posAtCoords(w(t));s&&(l=="singleClick"?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new Mt(e,s,t,!!r)):(l=="doubleClick"?Et:Ot)(e,s.pos,s.inside,t)?t.preventDefault():E(e,"pointer"))};class Mt{constructor(n,t,r,o){this.view=n,this.pos=t,this.event=r,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=n.state.doc,this.selectNode=!!r[Ge],this.allowDefault=r.shiftKey;let l,s;if(t.inside>-1)l=n.state.doc.nodeAt(t.inside),s=t.inside;else{let f=n.state.doc.resolve(t.pos);l=f.parent,s=f.depth?f.before():0}const i=o?null:r.target,a=i?n.docView.nearestDesc(i,!0):null;this.target=a?a.dom:null;let{selection:c}=n.state;(r.button==0&&l.type.spec.draggable&&l.type.spec.selectable!==!1||c instanceof h&&c.from<=s&&c.to>s)&&(this.mightDrag={node:l,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&v&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),n.root.addEventListener("mouseup",this.up=this.up.bind(this)),n.root.addEventListener("mousemove",this.move=this.move.bind(this)),E(n,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>de(this.view)),this.view.input.mouseDown=null}up(n){if(this.done(),!this.view.dom.contains(n.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(w(n))),this.updateAllowDefault(n),this.allowDefault||!t?E(this.view,"pointer"):xt(this.view,t.pos,t.inside,n,this.selectNode)?n.preventDefault():n.button==0&&(this.flushed||V&&this.mightDrag&&!this.mightDrag.node.isAtom||q&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(F(this.view,J.near(this.view.state.doc.resolve(t.pos))),n.preventDefault()):E(this.view,"pointer")}move(n){this.updateAllowDefault(n),E(this.view,"pointer"),n.buttons==0&&this.done()}updateAllowDefault(n){!this.allowDefault&&(Math.abs(this.event.x-n.clientX)>4||Math.abs(this.event.y-n.clientY)>4)&&(this.allowDefault=!0)}}N.touchstart=e=>{e.input.lastTouch=Date.now(),he(e),E(e,"pointer")};N.touchmove=e=>{e.input.lastTouch=Date.now(),E(e,"pointer")};N.contextmenu=e=>he(e);function Qe(e,n){return e.composing?!0:V&&Math.abs(n.timeStamp-e.input.compositionEndedAt)<500?(e.input.compositionEndedAt=-2e8,!0):!1}const Pt=X?5e3:-1;y.compositionstart=y.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:n}=e,t=n.selection.$from;if(n.selection.empty&&(n.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))e.markCursor=e.state.storedMarks||t.marks(),Z(e,!0),e.markCursor=null;else if(Z(e),v&&n.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let r=e.domSelectionRange();for(let o=r.focusNode,l=r.focusOffset;o&&o.nodeType==1&&l!=0;){let s=l<0?o.lastChild:o.childNodes[l-1];if(!s)break;if(s.nodeType==3){e.domSelection().collapse(s,s.nodeValue.length);break}else o=s,l=-1}}e.input.composing=!0}Ze(e,Pt)};y.compositionend=(e,n)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=n.timeStamp,Ze(e,20))};function Ze(e,n){clearTimeout(e.input.composingTimeout),n>-1&&(e.input.composingTimeout=setTimeout(()=>Z(e),n))}function Rt(e){for(e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=It());e.input.compositionNodes.length>0;)e.input.compositionNodes.pop().markParentsDirty()}function It(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}function Z(e,n=!1){if(!(X&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),Rt(e),n||e.docView&&e.docView.dirty){let t=ct(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):e.updateState(e.state),!0}return!1}}function $t(e,n){if(!e.dom.parentNode)return;let t=e.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(n),t.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),o=document.createRange();o.selectNodeContents(n),e.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),e.focus()},50)}const B=U&&Le<15||fe&&at<604;N.copy=y.cut=(e,n)=>{let t=n,r=e.state.selection,o=t.type=="cut";if(r.empty)return;let l=B?null:t.clipboardData,s=r.content(),{dom:i,text:a}=He(e,s);l?(t.preventDefault(),l.clearData(),l.setData("text/html",i.innerHTML),l.setData("text/plain",a)):$t(e,i),o&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Kt(e){return e.openStart==0&&e.openEnd==0&&e.content.childCount==1?e.content.firstChild:null}function zt(e,n){if(!e.dom.parentNode)return;let t=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,r=e.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout(()=>{e.focus(),r.parentNode&&r.parentNode.removeChild(r),t?ce(e,r.value,null,e.input.shiftKey,n):ce(e,r.textContent,r.innerHTML,e.input.shiftKey,n)},50)}function ce(e,n,t,r,o){let l=We(e,n,t,r,e.state.selection.$from);if(e.someProp("handlePaste",a=>a(e,o,l||O.empty)))return!0;if(!l)return!1;let s=Kt(l),i=s?e.state.tr.replaceSelectionWith(s,e.input.shiftKey):e.state.tr.replaceSelection(l);return e.dispatch(i.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}y.paste=(e,n)=>{let t=n;if(e.composing&&!X)return;let r=B?null:t.clipboardData;r&&ce(e,r.getData("text/plain"),r.getData("text/html"),e.input.shiftKey,t)?t.preventDefault():zt(e,t)};class Vt{constructor(n,t){this.slice=n,this.move=t}}const _e=C?"altKey":"ctrlKey";N.dragstart=(e,n)=>{let t=n,r=e.input.mouseDown;if(r&&r.done(),!t.dataTransfer)return;let o=e.state.selection,l=o.empty?null:e.posAtCoords(w(t));if(!(l&&l.pos>=o.from&&l.pos<=(o instanceof h?o.to-1:o.to))){if(r&&r.mightDrag)e.dispatch(e.state.tr.setSelection(h.create(e.state.doc,r.mightDrag.pos)));else if(t.target&&t.target.nodeType==1){let c=e.docView.nearestDesc(t.target,!0);c&&c.node.type.spec.draggable&&c!=e.docView&&e.dispatch(e.state.tr.setSelection(h.create(e.state.doc,c.posBefore)))}}let s=e.state.selection.content(),{dom:i,text:a}=He(e,s);t.dataTransfer.clearData(),t.dataTransfer.setData(B?"Text":"text/html",i.innerHTML),t.dataTransfer.effectAllowed="copyMove",B||t.dataTransfer.setData("text/plain",a),e.dragging=new Vt(s,!t[_e])};N.dragend=e=>{let n=e.dragging;window.setTimeout(()=>{e.dragging==n&&(e.dragging=null)},50)};y.dragover=y.dragenter=(e,n)=>n.preventDefault();y.drop=(e,n)=>{let t=n,r=e.dragging;if(e.dragging=null,!t.dataTransfer)return;let o=e.posAtCoords(w(t));if(!o)return;let l=e.state.doc.resolve(o.pos),s=r&&r.slice;s?e.someProp("transformPasted",g=>{s=g(s,e)}):s=We(e,t.dataTransfer.getData(B?"Text":"text/plain"),B?null:t.dataTransfer.getData("text/html"),!1,l);let i=!!(r&&!t[_e]);if(e.someProp("handleDrop",g=>g(e,t,s||O.empty,i))){t.preventDefault();return}if(!s)return;t.preventDefault();let a=s?rt(e.state.doc,l.pos,s):l.pos;a==null&&(a=l.pos);let c=e.state.tr;i&&c.deleteSelection();let f=c.mapping.map(a),u=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,p=c.doc;if(u?c.replaceRangeWith(f,f,s.content.firstChild):c.replaceRange(f,f,s),c.doc.eq(p))return;let d=c.doc.resolve(f);if(u&&h.isSelectable(s.content.firstChild)&&d.nodeAfter&&d.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new h(d));else{let g=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach((x,S,D,Y)=>g=Y),c.setSelection(Be(e,d,c.doc.resolve(g)))}e.focus(),e.dispatch(c.setMeta("uiEvent","drop"))};N.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout(()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&de(e)},20))};N.blur=(e,n)=>{let t=n;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),t.relatedTarget&&e.dom.contains(t.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)};N.beforeinput=(e,n)=>{if(q&&X&&n.inputType=="deleteContentBackward"){e.domObserver.flushSoon();let{domChangeCount:r}=e.input;setTimeout(()=>{if(e.input.domChangeCount!=r||(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",l=>l(e,ze(8,"Backspace")))))return;let{$cursor:o}=e.state.selection;o&&o.pos>0&&e.dispatch(e.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let e in y)N[e]=y[e];function W(e,n){if(e==n)return!0;for(let t in e)if(e[t]!==n[t])return!1;for(let t in n)if(!(t in e))return!1;return!0}class me{constructor(n,t){this.toDOM=n,this.spec=t||$,this.side=this.spec.side||0}map(n,t,r,o){let{pos:l,deleted:s}=n.mapResult(t.from+o,this.side<0?-1:1);return s?null:new T(l-r,l-r,this)}valid(){return!0}eq(n){return this==n||n instanceof me&&(this.spec.key&&this.spec.key==n.spec.key||this.toDOM==n.toDOM&&W(this.spec,n.spec))}destroy(n){this.spec.destroy&&this.spec.destroy(n)}}class A{constructor(n,t){this.attrs=n,this.spec=t||$}map(n,t,r,o){let l=n.map(t.from+o,this.spec.inclusiveStart?-1:1)-r,s=n.map(t.to+o,this.spec.inclusiveEnd?1:-1)-r;return l>=s?null:new T(l,s,this)}valid(n,t){return t.from<t.to}eq(n){return this==n||n instanceof A&&W(this.attrs,n.attrs)&&W(this.spec,n.spec)}static is(n){return n.type instanceof A}destroy(){}}class ge{constructor(n,t){this.attrs=n,this.spec=t||$}map(n,t,r,o){let l=n.mapResult(t.from+o,1);if(l.deleted)return null;let s=n.mapResult(t.to+o,-1);return s.deleted||s.pos<=l.pos?null:new T(l.pos-r,s.pos-r,this)}valid(n,t){let{index:r,offset:o}=n.content.findIndex(t.from),l;return o==t.from&&!(l=n.child(r)).isText&&o+l.nodeSize==t.to}eq(n){return this==n||n instanceof ge&&W(this.attrs,n.attrs)&&W(this.spec,n.spec)}destroy(){}}class T{constructor(n,t,r){this.from=n,this.to=t,this.type=r}copy(n,t){return new T(n,t,this.type)}eq(n,t=0){return this.type.eq(n.type)&&this.from+t==n.from&&this.to+t==n.to}map(n,t,r){return this.type.map(n,this,t,r)}static widget(n,t,r){return new T(n,n,new me(t,r))}static inline(n,t,r,o){return new T(n,t,new A(r,o))}static node(n,t,r,o){return new T(n,t,new ge(r,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof A}}const L=[],$={};class m{constructor(n,t){this.local=n.length?n:L,this.children=t.length?t:L}static create(n,t){return t.length?_(t,n,0,$):b}find(n,t,r){let o=[];return this.findInner(n==null?0:n,t==null?1e9:t,o,0,r),o}findInner(n,t,r,o,l){for(let s=0;s<this.local.length;s++){let i=this.local[s];i.from<=t&&i.to>=n&&(!l||l(i.spec))&&r.push(i.copy(i.from+o,i.to+o))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<t&&this.children[s+1]>n){let i=this.children[s]+1;this.children[s+2].findInner(n-i,t-i,r,o+i,l)}}map(n,t,r){return this==b||n.maps.length==0?this:this.mapInner(n,t,0,0,r||$)}mapInner(n,t,r,o,l){let s;for(let i=0;i<this.local.length;i++){let a=this.local[i].map(n,r,o);a&&a.type.valid(t,a)?(s||(s=[])).push(a):l.onRemove&&l.onRemove(this.local[i].spec)}return this.children.length?Lt(this.children,s||[],n,t,r,o,l):s?new m(s.sort(K),L):b}add(n,t){return t.length?this==b?m.create(n,t):this.addInner(n,t,0):this}addInner(n,t,r){let o,l=0;n.forEach((i,a)=>{let c=a+r,f;if(f=we(t,i,c)){for(o||(o=this.children.slice());l<o.length&&o[l]<a;)l+=3;o[l]==a?o[l+2]=o[l+2].addInner(i,f,c+1):o.splice(l,0,a,a+i.nodeSize,_(f,i,c+1,$)),l+=3}});let s=ve(l?et(t):t,-r);for(let i=0;i<s.length;i++)s[i].type.valid(n,s[i])||s.splice(i--,1);return new m(s.length?this.local.concat(s).sort(K):this.local,o||this.children)}remove(n){return n.length==0||this==b?this:this.removeInner(n,0)}removeInner(n,t){let r=this.children,o=this.local;for(let l=0;l<r.length;l+=3){let s,i=r[l]+t,a=r[l+1]+t;for(let f=0,u;f<n.length;f++)(u=n[f])&&u.from>i&&u.to<a&&(n[f]=null,(s||(s=[])).push(u));if(!s)continue;r==this.children&&(r=this.children.slice());let c=r[l+2].removeInner(s,i+1);c!=b?r[l+2]=c:(r.splice(l,3),l-=3)}if(o.length){for(let l=0,s;l<n.length;l++)if(s=n[l])for(let i=0;i<o.length;i++)o[i].eq(s,t)&&(o==this.local&&(o=this.local.slice()),o.splice(i--,1))}return r==this.children&&o==this.local?this:o.length||r.length?new m(o,r):b}forChild(n,t){if(this==b)return this;if(t.isLeaf)return m.empty;let r,o;for(let i=0;i<this.children.length;i+=3)if(this.children[i]>=n){this.children[i]==n&&(r=this.children[i+2]);break}let l=n+1,s=l+t.content.size;for(let i=0;i<this.local.length;i++){let a=this.local[i];if(a.from<s&&a.to>l&&a.type instanceof A){let c=Math.max(l,a.from)-l,f=Math.min(s,a.to)-l;c<f&&(o||(o=[])).push(a.copy(c,f))}}if(o){let i=new m(o.sort(K),L);return r?new I([i,r]):i}return r||b}eq(n){if(this==n)return!0;if(!(n instanceof m)||this.local.length!=n.local.length||this.children.length!=n.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(n.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=n.children[t]||this.children[t+1]!=n.children[t+1]||!this.children[t+2].eq(n.children[t+2]))return!1;return!0}locals(n){return be(this.localsInner(n))}localsInner(n){if(this==b)return L;if(n.inlineContent||!this.local.some(A.is))return this.local;let t=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof A||t.push(this.local[r]);return t}}m.empty=new m([],[]);m.removeOverlap=be;const b=m.empty;class I{constructor(n){this.members=n}map(n,t){const r=this.members.map(o=>o.map(n,t,$));return I.from(r)}forChild(n,t){if(t.isLeaf)return m.empty;let r=[];for(let o=0;o<this.members.length;o++){let l=this.members[o].forChild(n,t);l!=b&&(l instanceof I?r=r.concat(l.members):r.push(l))}return I.from(r)}eq(n){if(!(n instanceof I)||n.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(n.members[t]))return!1;return!0}locals(n){let t,r=!0;for(let o=0;o<this.members.length;o++){let l=this.members[o].localsInner(n);if(l.length)if(!t)t=l;else{r&&(t=t.slice(),r=!1);for(let s=0;s<l.length;s++)t.push(l[s])}}return t?be(r?t:t.sort(K)):L}static from(n){switch(n.length){case 0:return b;case 1:return n[0];default:return new I(n.every(t=>t instanceof m)?n:n.reduce((t,r)=>t.concat(r instanceof m?r:r.members),[]))}}}function Lt(e,n,t,r,o,l,s){let i=e.slice();for(let c=0,f=l;c<t.maps.length;c++){let u=0;t.maps[c].forEach((p,d,g,x)=>{let S=x-g-(d-p);for(let D=0;D<i.length;D+=3){let Y=i[D+1];if(Y<0||p>Y+f-u)continue;let ye=i[D]+f-u;d>=ye?i[D+1]=p<=ye?-2:-1:g>=o&&S&&(i[D]+=S,i[D+1]+=S)}u+=S}),f=t.maps[c].map(f,-1)}let a=!1;for(let c=0;c<i.length;c+=3)if(i[c+1]<0){if(i[c+1]==-2){a=!0,i[c+1]=-1;continue}let f=t.map(e[c]+l),u=f-o;if(u<0||u>=r.content.size){a=!0;continue}let p=t.map(e[c+1]+l,-1),d=p-o,{index:g,offset:x}=r.content.findIndex(u),S=r.maybeChild(g);if(S&&x==u&&x+S.nodeSize==d){let D=i[c+2].mapInner(t,S,f+1,e[c]+l+1,s);D!=b?(i[c]=u,i[c+1]=d,i[c+2]=D):(i[c+1]=-2,a=!0)}else a=!0}if(a){let c=Ft(i,e,n,t,o,l,s),f=_(c,r,0,s);n=f.local;for(let u=0;u<i.length;u+=3)i[u+1]<0&&(i.splice(u,3),u-=3);for(let u=0,p=0;u<f.children.length;u+=3){let d=f.children[u];for(;p<i.length&&i[p]<d;)p+=3;i.splice(p,0,f.children[u],f.children[u+1],f.children[u+2])}}return new m(n.sort(K),i)}function ve(e,n){if(!n||!e.length)return e;let t=[];for(let r=0;r<e.length;r++){let o=e[r];t.push(new T(o.from+n,o.to+n,o.type))}return t}function Ft(e,n,t,r,o,l,s){function i(a,c){for(let f=0;f<a.local.length;f++){let u=a.local[f].map(r,o,c);u?t.push(u):s.onRemove&&s.onRemove(a.local[f].spec)}for(let f=0;f<a.children.length;f+=3)i(a.children[f+2],a.children[f]+c+1)}for(let a=0;a<e.length;a+=3)e[a+1]==-1&&i(e[a+2],n[a]+l+1);return t}function we(e,n,t){if(n.isLeaf)return null;let r=t+n.nodeSize,o=null;for(let l=0,s;l<e.length;l++)(s=e[l])&&s.from>t&&s.to<r&&((o||(o=[])).push(s),e[l]=null);return o}function et(e){let n=[];for(let t=0;t<e.length;t++)e[t]!=null&&n.push(e[t]);return n}function _(e,n,t,r){let o=[],l=!1;n.forEach((i,a)=>{let c=we(e,i,a+t);if(c){l=!0;let f=_(c,i,t+a+1,r);f!=b&&o.push(a,a+i.nodeSize,f)}});let s=ve(l?et(e):e,-t).sort(K);for(let i=0;i<s.length;i++)s[i].type.valid(n,s[i])||(r.onRemove&&r.onRemove(s[i].spec),s.splice(i--,1));return s.length||o.length?new m(s,o):b}function K(e,n){return e.from-n.from||e.to-n.to}function be(e){let n=e;for(let t=0;t<n.length-1;t++){let r=n[t];if(r.from!=r.to)for(let o=t+1;o<n.length;o++){let l=n[o];if(l.from==r.from){l.to!=r.to&&(n==e&&(n=e.slice()),n[o]=l.copy(l.from,r.to),Re(n,o+1,l.copy(r.to,l.to)));continue}else{l.from<r.to&&(n==e&&(n=e.slice()),n[t]=r.copy(r.from,l.from),Re(n,o,r.copy(l.from,r.to)));break}}}return n}function Re(e,n,t){for(;n<e.length&&K(t,e[n])>0;)n++;e.splice(n,0,t)}export{T as D,m as a};
