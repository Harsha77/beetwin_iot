import{l as r,z as D,b as N,c as i,a as t,t as a,f as m,I as b,J as y,n as J,F as K,k as Q,K as Y,o as d}from"./@vue-D0TGCZL2.js";import{_ as Z}from"./Download-D1HoHf0Z.js";import{u as ee}from"./vue-router-DxnAzFk_.js";import{a as A}from"./axios-ByivMYyX.js";import{s as B}from"./index-3A53bn28.js";import{a as te}from"./frappe-ui-SSzMBOOI.js";import"./@tiptap-BUCYMH7K.js";import"./showdown-Dkx33vR8.js";import"./socket.io-client-De6w114h.js";import{u as I,w as se}from"./xlsx-DaVhO591.js";import"./leaflet-BUr-PN-6.js";import"./prosemirror-state-DgsmxDjm.js";import"./prosemirror-model-C_7RDaDb.js";import"./prosemirror-transform-DoYUQK9o.js";import"./idb-keyval-BrH4ksw2.js";import"./prosemirror-dropcursor-BfstMEHz.js";import"./prosemirror-gapcursor-DAo5-j_C.js";import"./prosemirror-keymap-CVi9LBYH.js";import"./w3c-keyname-_MXnRwJa.js";import"./prosemirror-view-W--SXXbD.js";import"./prosemirror-history-DKyN9Nbl.js";import"./rope-sequence-DGojYqW9.js";import"./prosemirror-tables-DrV9oBPp.js";import"./linkifyjs-Bb8FdQht.js";import"./prosemirror-commands-Lnq4s3Q2.js";import"./prosemirror-schema-list-B9x1aVA0.js";import"./engine.io-client-CveMJrUI.js";import"./engine.io-parser-6vJSFETq.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-D89bkXp7.js";const oe="/assets/beetwin_iot/beetwin_hs/IOtweet%20Logo_2.0%20white.png",re={class:"min-h-screen flex flex-col"},ae={class:"fixed top-0 left-0 w-full flex items-center justify-between py-4 border-b bg-[#08444c] shadow px-5 z-50"},le={class:"bg-gray-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold"},ne=["src"],ie={key:0,class:"absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-20"},de={class:"block px-4 py-2 text-gray-700 font-semibold break-all"},ue={key:1,class:"fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50"},pe={class:"bg-white p-6 rounded-md w-96"},me={key:0,class:"text-red-500 mt-2"},ce={key:1,class:"text-green-500 mt-2"},ge={class:"flex-grow flex flex-col md:flex-row"},be={key:0,class:"flex-grow p-6 pt-16"},we={class:"flex justify-between items-center p-4"},fe={class:"flex items-center gap-2"},he={class:"mt-4"},ye={class:"table-auto w-full border-collapse border border-gray-300"},ve={key:0},xe=["onClick"],_e={class:"border border-gray-300 px-4 py-2"},ke={class:"border border-gray-300 px-4 py-2"},Se={class:"border border-gray-300 px-4 py-2"},Pe={class:"border border-gray-300 px-4 py-2"},De={class:"border border-gray-300 px-4 py-2"},Ne={class:"border border-gray-300 px-4 py-2"},Ie={class:"border border-gray-300 px-4 py-2"},Ce={class:"flex justify-between items-center mt-4"},Ue=["disabled"],Ae=["disabled"],dt={__name:"Home",setup(Be){const w=r("/User.png");te({url:"/api/method/frappe.auth.get_logged_user",auto:!0,onSuccess:async s=>{if(s){const e=await T(s.message),o=(e==null?void 0:e.user_image)||L()||"/User.png";w.value=o,window.user_image_path=o,console.log("Image Path:",o)}}});const T=async s=>{const e=await fetch(`/api/resource/User/${s}`);return e.ok?await e.json():null},L=()=>{const s=document.cookie.match(/user_image=([^;]+)/);return s?decodeURIComponent(s[1]):null};D(()=>{window.user_image_path&&(w.value=window.user_image_path)});const H=ee(),p=r([]),v=r(""),c=r(10),u=r(1),x=r(!1),_=r(""),g=r(""),k=r(""),f=r(""),S=r(""),R=async()=>{var s,e,o;if(f.value!==S.value){g.value="Passwords do not match.";return}try{const l=await A.post("/api/method/beetwin_iot.beetwin_iot.api.changedpassword.admin_change_password",{user:U.value,old_password:k.value,new_password:f.value});l.data.message==="Password Updated"?(_.value="Password changed successfully.",setTimeout(()=>{console.log("Closing modal..."),x.value=!1},1500)):g.value=l.data.message||"Unexpected error."}catch(l){console.error("API Error:",(s=l.response)==null?void 0:s.data),g.value=((o=(e=l.response)==null?void 0:e.data)==null?void 0:o.message)||"Failed to update password."}},j=s=>{const o=document.cookie.split("; ").find(l=>l.startsWith(s+"="));return o?decodeURIComponent(o.split("=")[1]):null};D(()=>{const s=j("user_image");s&&(w.value=`/api/method/frappe.utils.print_format.download_pdf?file_url=${s}`)});const M=()=>{if(p.value.length===0){alert("No data to export.");return}const e=[...p.value].sort((n,G)=>n.serialNumber.localeCompare(G.serialNumber)).map(n=>({"Serial Number":n.serialNumber,"Device ID":n.deviceId,Timestamp:n.timestamp,"Pressure (bar)":n.latestData.pv,"Battery (%)":n.latestData.bt,"Sensor Health":n.latestData.ht==="0"?"Open":"Healthy","Signal Strength":n.latestData.rssi})),o=I.json_to_sheet(e),l=I.book_new();I.book_append_sheet(l,o,"BTX-PP Data"),se(l,"BTX-PP Data.xlsx")},C=r(2),V=()=>{C.value=2},h=r(!1),O=()=>{h.value=!h.value};function E(){B.logout.submit(),h.value=!1}const U=r(B.user||"Guest"),F=N(()=>p.value.filter(s=>s.serialNumber.toString().includes(v.value.trim())).sort((s,e)=>s.serialNumber.localeCompare(e.serialNumber))),z=N(()=>{const s=(u.value-1)*c.value;return F.value.slice(s,s+c.value)}),P=N(()=>Math.ceil(p.value.length/c.value)),$=async()=>{try{const s=await A.get("/api/method/beetwin_iot.beetwin_iot.api.get_latest_device_data.get_filtered_device_data");console.log("API Response from Cloud:",s.data),s.data&&s.data.message&&s.data.message.status==="success"?p.value=s.data.message.data.filter(e=>e&&(e["Serial Number"]||e["Battery (%)"]||e["Pressure (bar)"]||e["Sensor Health"]||e.Latitude||e.Longitude||e["RSSI Value"])).map(e=>({deviceId:e["Device ID"]||"N/A",serialNumber:e["Serial Number"]?e["Serial Number"].toString():"N/A",timestamp:e.Timestamp?e.Timestamp.slice(0,16):"N/A",latestData:{pv:e["Pressure (bar)"]?e["Pressure (bar)"].toString():"N/A",bt:e["Battery (%)"]?e["Battery (%)"].toString():"N/A",ht:e["Sensor Health"]?e["Sensor Health"].toString():"N/A",lat:e.Latitude?e.Latitude.toString():"N/A",long:e.Longitude?e.Longitude.toString():"N/A",rssi:e["RSSI Value"]?e["RSSI Value"].toString():"N/A"}})):console.error("Invalid API response:",s.data)}catch(s){console.error("Error fetching devices:",s)}},X=(s,e)=>{H.push({name:"DeviceDetails",params:{deviceId:s},query:{serialNumber:e}})},W=()=>{u.value<P.value&&u.value++},q=()=>{u.value>1&&u.value--};return D($),(s,e)=>(d(),i("div",re,[t("header",ae,[e[9]||(e[9]=t("img",{src:oe,alt:"IoTweet Logo",class:"w-28"},null,-1)),e[10]||(e[10]=t("div",{class:"text-white flex-1 text-center font-bold text-xl"},"BEETWIN-HS DASHBOARD",-1)),t("button",{onClick:e[0]||(e[0]=(...o)=>s.toggleSidebar&&s.toggleSidebar(...o)),class:"lg:hidden text-white ml-auto"},e[7]||(e[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])),t("div",{class:"relative ml-4",onClick:O},[t("button",le,[t("img",{src:w.value,alt:"User Image",class:"w-full h-full object-cover rounded-full"},null,8,ne)]),h.value?(d(),i("div",ie,[t("p",de,a(U.value),1),t("a",{href:"#",onClick:E,class:"block px-4 py-2 text-gray-700 hover:bg-gray-100"},"Logout")])):m("",!0),x.value?(d(),i("div",ue,[t("div",pe,[e[8]||(e[8]=t("h2",{class:"text-xl font-bold mb-4"},"Change Password",-1)),b(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),type:"password",placeholder:"Current Password",class:"w-full p-2 border rounded-md mb-2"},null,512),[[y,k.value]]),b(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>f.value=o),type:"password",placeholder:"New Password",class:"w-full p-2 border rounded-md mb-2"},null,512),[[y,f.value]]),b(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>S.value=o),type:"password",placeholder:"Confirm New Password",class:"w-full p-2 border rounded-md mb-4"},null,512),[[y,S.value]]),t("button",{onClick:R,class:"w-full bg-blue-500 text-white p-2 rounded-md"},"Update Password"),t("button",{onClick:e[4]||(e[4]=o=>x.value=!1),class:"w-full mt-2 text-gray-600"},"Cancel"),g.value?(d(),i("p",me,a(g.value),1)):m("",!0),_.value?(d(),i("p",ce,a(_.value),1)):m("",!0)])])):m("",!0)])]),t("main",ge,[t("aside",{class:J([{hidden:!s.isSidebarOpen,"lg:block":!0,"bg-[#08444c] text-white p-5 border-r transition-all duration-300":!0},"mt-16"])},[t("nav",null,[t("ul",{class:"space-y-4 text-lg font-semibold"},[t("li",null,[t("a",{href:"#",onClick:V,class:"flex items-center space-x-2 hover:text-gray-300"},e[11]||(e[11]=[t("span",null,"DASHBOARD",-1)]))])])])],2),C.value===2?(d(),i("div",be,[t("div",we,[e[13]||(e[13]=t("h2",{class:"text-lg font-semibold leading-[3.15] ml-[583px]"},"BTX-PP",-1)),t("div",fe,[b(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=o=>v.value=o),placeholder:"Search Serial Number",class:"border p-2 rounded-md w-64"},null,512),[[y,v.value]]),t("button",{onClick:M,class:"ml-4"},e[12]||(e[12]=[t("img",{src:Z,alt:"Download",class:"w-10 h-10"},null,-1)]))])]),t("div",he,[e[18]||(e[18]=t("div",{class:"flex justify-end mb-2"},null,-1)),t("table",ye,[e[15]||(e[15]=t("thead",{class:"bg-[#08444c] text-white"},[t("tr",null,[t("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Serial Number"),t("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Device ID"),t("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Timestamp"),t("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Pressure (bar)"),t("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Battery (%)"),t("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Sensor Health"),t("th",{class:"border border-gray-300 px-4 py-2 text-center"},"Signal Strength")])],-1)),t("tbody",null,[p.value.length===0?(d(),i("tr",ve,e[14]||(e[14]=[t("td",{colspan:"9",class:"text-center text-red-500 font-bold py-4"},"No allowed device groups found.",-1)]))):m("",!0),(d(!0),i(K,null,Q(z.value,o=>(d(),i("tr",{key:o.deviceId,onClick:l=>X(o.deviceId,o.serialNumber),class:"cursor-pointer hover:bg-gray-100 transition-all text-center"},[t("td",_e,a(o.serialNumber),1),t("td",ke,a(o.deviceId),1),t("td",Se,a(o.timestamp),1),t("td",Pe,a(o.latestData.pv),1),t("td",De,a(o.latestData.bt),1),t("td",Ne,a(o.latestData.ht==="0"?"Open":"Healthy"),1),t("td",Ie,a(o.latestData.rssi),1)],8,xe))),128))])]),t("div",Ce,[t("div",null,[e[17]||(e[17]=t("label",{class:"mr-2"},"Items per page:",-1)),b(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>c.value=o),class:"border p-2 rounded-md w-15"},e[16]||(e[16]=[t("option",{value:"10"},"10",-1),t("option",{value:"25"},"25",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1)]),512),[[Y,c.value]])]),t("div",null,[t("button",{onClick:q,disabled:u.value===1,class:"px-4 py-2 border rounded-md bg-gray-200 mr-2"},"Prev",8,Ue),t("span",null,"Page "+a(u.value)+" of "+a(P.value),1),t("button",{onClick:W,disabled:u.value===P.value,class:"px-4 py-2 border rounded-md bg-gray-200 ml-2"},"Next",8,Ae)])])])])):m("",!0)])]))}};export{dt as default};
