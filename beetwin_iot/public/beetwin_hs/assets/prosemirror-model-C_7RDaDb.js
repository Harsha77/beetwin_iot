function A(o,t,e){for(let n=0;;n++){if(n==o.childCount||n==t.childCount)return o.childCount==t.childCount?null:e;let i=o.child(n),r=t.child(n);if(i==r){e+=i.nodeSize;continue}if(!i.sameMarkup(r))return e;if(i.isText&&i.text!=r.text){for(let s=0;i.text[s]==r.text[s];s++)e++;return e}if(i.content.size||r.content.size){let s=A(i.content,r.content,e+1);if(s!=null)return s}e+=i.nodeSize}}function I(o,t,e,n){for(let i=o.childCount,r=t.childCount;;){if(i==0||r==0)return i==r?null:{a:e,b:n};let s=o.child(--i),l=t.child(--r),h=s.nodeSize;if(s==l){e-=h,n-=h;continue}if(!s.sameMarkup(l))return{a:e,b:n};if(s.isText&&s.text!=l.text){let f=0,a=Math.min(s.text.length,l.text.length);for(;f<a&&s.text[s.text.length-f-1]==l.text[l.text.length-f-1];)f++,e--,n--;return{a:e,b:n}}if(s.content.size||l.content.size){let f=I(s.content,l.content,e-1,n-1);if(f)return f}e-=h,n-=h}}class c{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,i=0,r){for(let s=0,l=0;l<e;s++){let h=this.content[s],f=l+h.nodeSize;if(f>t&&n(h,i+l,r||null,s)!==!1&&h.content.size){let a=l+1;h.nodesBetween(Math.max(0,t-a),Math.min(h.content.size,e-a),n,i+a)}l=f}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,i){let r="",s=!0;return this.nodesBetween(t,e,(l,h)=>{l.isText?(r+=l.text.slice(Math.max(t,h)-h,e-h),s=!n):l.isLeaf?(i?r+=typeof i=="function"?i(l):i:l.type.spec.leafText&&(r+=l.type.spec.leafText(l)),s=!n):!s&&l.isBlock&&(r+=n,s=!0)},0),r}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,i=this.content.slice(),r=0;for(e.isText&&e.sameMarkup(n)&&(i[i.length-1]=e.withText(e.text+n.text),r=1);r<t.content.length;r++)i.push(t.content[r]);return new c(i,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let n=[],i=0;if(e>t)for(let r=0,s=0;s<e;r++){let l=this.content[r],h=s+l.nodeSize;h>t&&((s<t||h>e)&&(l.isText?l=l.cut(Math.max(0,t-s),Math.min(l.text.length,e-s)):l=l.cut(Math.max(0,t-s-1),Math.min(l.content.size,e-s-1))),n.push(l),i+=l.nodeSize),s=h}return new c(n,i)}cutByIndex(t,e){return t==e?c.empty:t==0&&e==this.content.length?this:new c(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let i=this.content.slice(),r=this.size+e.nodeSize-n.nodeSize;return i[t]=e,new c(i,r)}addToStart(t){return new c([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new c(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let i=this.content[e];t(i,n,e),n+=i.nodeSize}}findDiffStart(t,e=0){return A(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return I(this,t,e,n)}findIndex(t,e=-1){if(t==0)return y(0,t);if(t==this.size)return y(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,i=0;;n++){let r=this.child(n),s=i+r.nodeSize;if(s>=t)return s==t||e>0?y(n+1,s):y(n,i);i=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return c.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new c(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return c.empty;let e,n=0;for(let i=0;i<t.length;i++){let r=t[i];n+=r.nodeSize,i&&r.isText&&t[i-1].sameMarkup(r)?(e||(e=t.slice(0,i)),e[e.length-1]=r.withText(e[e.length-1].text+r.text)):e&&e.push(r)}return new c(e||t,n)}static from(t){if(!t)return c.empty;if(t instanceof c)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new c([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}c.empty=new c([],0);const w={index:0,offset:0};function y(o,t){return w.index=o,w.offset=t,w}function E(o,t){if(o===t)return!0;if(!(o&&typeof o=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(o);if(Array.isArray(t)!=e)return!1;if(e){if(o.length!=t.length)return!1;for(let n=0;n<o.length;n++)if(!E(o[n],t[n]))return!1}else{for(let n in o)if(!(n in t)||!E(o[n],t[n]))return!1;for(let n in t)if(!(n in o))return!1}return!0}class u{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let i=0;i<t.length;i++){let r=t[i];if(this.eq(r))return t;if(this.type.excludes(r.type))e||(e=t.slice(0,i));else{if(r.type.excludes(this.type))return t;!n&&r.type.rank>this.type.rank&&(e||(e=t.slice(0,i)),e.push(this),n=!0),e&&e.push(r)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&E(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);return n.create(e.attrs)}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return u.none;if(t instanceof u)return[t];let e=t.slice();return e.sort((n,i)=>n.type.rank-i.type.rank),e}}u.none=[];class K extends Error{}class d{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=b(this.content,t+this.openStart,e);return n&&new d(n,this.openStart,this.openEnd)}removeBetween(t,e){return new d(v(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return d.empty;let n=e.openStart||0,i=e.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new d(c.fromJSON(t,e.content),n,i)}static maxOpen(t,e=!0){let n=0,i=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let r=t.lastChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.lastChild)i++;return new d(t,n,i)}}d.empty=new d(c.empty,0,0);function v(o,t,e){let{index:n,offset:i}=o.findIndex(t),r=o.maybeChild(n),{index:s,offset:l}=o.findIndex(e);if(i==t||r.isText){if(l!=e&&!o.child(s).isText)throw new RangeError("Removing non-flat range");return o.cut(0,t).append(o.cut(e))}if(n!=s)throw new RangeError("Removing non-flat range");return o.replaceChild(n,r.copy(v(r.content,t-i-1,e-i-1)))}function b(o,t,e,n){let{index:i,offset:r}=o.findIndex(t),s=o.maybeChild(i);if(r==t||s.isText)return o.cut(0,t).append(e).append(o.cut(t));let l=b(s.content,t-r-1,e);return l&&o.replaceChild(i,s.copy(l))}class Q{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}function q(o){let t=Object.create(null);for(let e in o){let n=o[e];if(!n.hasDefault)return null;t[e]=n.default}return t}function L(o,t){let e=Object.create(null);for(let n in o){let i=t&&t[n];if(i===void 0){let r=o[n];if(r.hasDefault)i=r.default;else throw new RangeError("No value supplied for attribute "+n)}e[n]=i}return e}function J(o){let t=Object.create(null);if(o)for(let e in o)t[e]=new $(o[e]);return t}class ${constructor(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default}get isRequired(){return!this.hasDefault}}class R{constructor(t,e,n,i){this.name=t,this.rank=e,this.schema=n,this.spec=i,this.attrs=J(i.attrs),this.excluded=null;let r=q(this.attrs);this.instance=r?new u(this,r):null}create(t=null){return!t&&this.instance?this.instance:new u(this,L(this.attrs,t))}static compile(t,e){let n=Object.create(null),i=0;return t.forEach((r,s)=>n[r]=new R(r,i++,e,s)),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}excludes(t){return this.excluded.indexOf(t)>-1}}class T{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach(n=>{n.tag?this.tags.push(n):n.style&&this.styles.push(n)}),this.normalizeLists=!this.tags.some(n=>{if(!/^(ul|ol)\b/.test(n.tag)||!n.node)return!1;let i=t.nodes[n.node];return i.contentMatch.matchType(i)})}parse(t,e={}){let n=new C(this,e,!1);return n.addAll(t,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new C(this,e,!0);return n.addAll(t,e.from,e.to),d.maxOpen(n.finish())}matchTag(t,e,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let r=this.tags[i];if(V(t,r.tag)&&(r.namespace===void 0||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){let s=r.getAttrs(t);if(s===!1)continue;r.attrs=s||void 0}return r}}}matchStyle(t,e,n,i){for(let r=i?this.styles.indexOf(i)+1:0;r<this.styles.length;r++){let s=this.styles[r],l=s.style;if(!(l.indexOf(t)!=0||s.context&&!n.matchesContext(s.context)||l.length>t.length&&(l.charCodeAt(t.length)!=61||l.slice(t.length+1)!=e))){if(s.getAttrs){let h=s.getAttrs(e);if(h===!1)continue;s.attrs=h||void 0}return s}}}static schemaRules(t){let e=[];function n(i){let r=i.priority==null?50:i.priority,s=0;for(;s<e.length;s++){let l=e[s];if((l.priority==null?50:l.priority)<r)break}e.splice(s,0,i)}for(let i in t.marks){let r=t.marks[i].spec.parseDOM;r&&r.forEach(s=>{n(s=N(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in t.nodes){let r=t.nodes[i].spec.parseDOM;r&&r.forEach(s=>{n(s=N(s)),s.node||s.ignore||s.mark||(s.node=i)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new T(t,T.schemaRules(t)))}}const D={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},j={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},B={ol:!0,ul:!0},k=1,S=2,m=4;function O(o,t,e){return t!=null?(t?k:0)|(t==="full"?S:0):o&&o.whitespace=="pre"?k|S:e&~m}class x{constructor(t,e,n,i,r,s,l){this.type=t,this.attrs=e,this.marks=n,this.pendingMarks=i,this.solid=r,this.options=l,this.content=[],this.activeMarks=u.none,this.stashMarks=[],this.match=s||(l&m?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(c.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(t.type))?(this.match=n,i):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&k)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let r=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-i[0].length))}}let e=c.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(c.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}popFromStashMark(t){for(let e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]}applyPending(t){for(let e=0,n=this.pendingMarks;e<n.length;e++){let i=n[e];(this.type?this.type.allowsMarkType(i.type):G(i.type,t))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!D.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class C{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0;let i=e.topNode,r,s=O(null,e.preserveWhitespace,0)|(n?m:0);i?r=new x(i.type,i.attrs,u.none,u.none,!0,e.topMatch||i.type.contentMatch,s):n?r=new x(null,null,u.none,u.none,!0,null,s):r=new x(t.schema.topNodeType,null,u.none,u.none,!0,null,s),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t){if(t.nodeType==3)this.addTextNode(t);else if(t.nodeType==1){let e=t.getAttribute("style");if(!e)this.addElement(t);else{let n=this.readStyles(U(e));if(!n)return;let[i,r]=n,s=this.top;for(let l=0;l<r.length;l++)this.removePendingMark(r[l],s);for(let l=0;l<i.length;l++)this.addPendingMark(i[l]);this.addElement(t);for(let l=0;l<i.length;l++)this.removePendingMark(i[l],s);for(let l=0;l<r.length;l++)this.addPendingMark(r[l])}}}addTextNode(t){let e=t.nodeValue,n=this.top;if(n.options&S||n.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&k)n.options&S?e=e.replace(/\r\n?/g,`
`):e=e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){let i=n.content[n.content.length-1],r=t.previousSibling;(!i||r&&r.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)}addElement(t,e){let n=t.nodeName.toLowerCase(),i;B.hasOwnProperty(n)&&this.parser.normalizeLists&&W(t);let r=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,e));if(r?r.ignore:j.hasOwnProperty(n))this.findInside(t),this.ignoreFallback(t);else if(!r||r.skip||r.closeParent){r&&r.closeParent?this.open=Math.max(0,this.open-1):r&&r.skip.nodeType&&(t=r.skip);let s,l=this.top,h=this.needsBlock;if(D.hasOwnProperty(n))l.content.length&&l.content[0].isInline&&this.open&&(this.open--,l=this.top),s=!0,l.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t),s&&this.sync(l),this.needsBlock=h}else this.addElementByRule(t,r,r.consuming===!1?i:void 0)}leafFallback(t){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`))}ignoreFallback(t){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(t){let e=u.none,n=u.none;t:for(let i=0;i<t.length;i+=2)for(let r=void 0;;){let s=this.parser.matchStyle(t[i],t[i+1],this,r);if(!s)continue t;if(s.ignore)return null;if(s.clearMark?this.top.pendingMarks.forEach(l=>{s.clearMark(l)&&(n=l.addToSet(n))}):e=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(e),s.consuming===!1)r=s;else break}return[e,n]}addElementByRule(t,e,n){let i,r,s;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):i=this.enter(r,e.attrs||null,e.preserveWhitespace)):(s=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(s));let l=this.top;if(r&&r.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(h=>this.insertNode(h));else{let h=t;typeof e.contentElement=="string"?h=t.querySelector(e.contentElement):typeof e.contentElement=="function"?h=e.contentElement(t):e.contentElement&&(h=e.contentElement),this.findAround(t,h,!0),this.addAll(h)}i&&this.sync(l)&&this.open--,s&&this.removePendingMark(s,l)}addAll(t,e,n){let i=e||0;for(let r=e?t.childNodes[e]:t.firstChild,s=n==null?null:t.childNodes[n];r!=s;r=r.nextSibling,++i)this.findAtPoint(t,i),this.addDOM(r);this.findAtPoint(t,i)}findPlace(t){let e,n;for(let i=this.open;i>=0;i--){let r=this.nodes[i],s=r.findWrapping(t);if(s&&(!e||e.length>s.length)&&(e=s,n=r,!s.length)||r.solid)break}if(!e)return!1;this.sync(n);for(let i=0;i<e.length;i++)this.enterInner(e[i],null,!1);return!0}insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();let e=this.top;e.applyPending(t.type),e.match&&(e.match=e.match.matchType(t.type));let n=e.activeMarks;for(let i=0;i<t.marks.length;i++)(!e.type||e.type.allowsMarkType(t.marks[i].type))&&(n=t.marks[i].addToSet(n));return e.content.push(t.mark(n)),!0}return!1}enter(t,e,n){let i=this.findPlace(t.create(e));return i&&this.enterInner(t,e,!0,n),i}enterInner(t,e=null,n=!1,i){this.closeExtra();let r=this.top;r.applyPending(t),r.match=r.match&&r.match.matchType(t);let s=O(t,i,r.options);r.options&m&&r.content.length==0&&(s|=m),this.nodes.push(new x(t,e,r.activeMarks,r.pendingMarks,n,null,s)),this.open++}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t)return this.open=e,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let i=n.length-1;i>=0;i--)t+=n[i].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)&&e.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),r=-(n?n.depth+1:0)+(i?0:1),s=(l,h)=>{for(;l>=0;l--){let f=e[l];if(f==""){if(l==e.length-1||l==0)continue;for(;h>=r;h--)if(s(l-1,h))return!0;return!1}else{let a=h>0||h==0&&i?this.nodes[h].type:n&&h>=r?n.node(h-r).type:null;if(!a||a.name!=f&&a.groups.indexOf(f)==-1)return!1;h--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let n=this.parser.schema.nodes[e];if(n.isTextblock&&n.defaultAttrs)return n}}addPendingMark(t){let e=H(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)}removePendingMark(t,e){for(let n=this.open;n>=0;n--){let i=this.nodes[n];if(i.pendingMarks.lastIndexOf(t)>-1)i.pendingMarks=t.removeFromSet(i.pendingMarks);else{i.activeMarks=t.removeFromSet(i.activeMarks);let s=i.popFromStashMark(t);s&&i.type&&i.type.allowsMarkType(s.type)&&(i.activeMarks=s.addToSet(i.activeMarks))}if(i==e)break}}}function W(o){for(let t=o.firstChild,e=null;t;t=t.nextSibling){let n=t.nodeType==1?t.nodeName.toLowerCase():null;n&&B.hasOwnProperty(n)&&e?(e.appendChild(t),t=e):n=="li"?e=t:n&&(e=null)}}function V(o,t){return(o.matches||o.msMatchesSelector||o.webkitMatchesSelector||o.mozMatchesSelector).call(o,t)}function U(o){let t=/\s*([\w-]+)\s*:\s*([^;]+)/g,e,n=[];for(;e=t.exec(o);)n.push(e[1],e[2].trim());return n}function N(o){let t={};for(let e in o)t[e]=o[e];return t}function G(o,t){let e=t.schema.nodes;for(let n in e){let i=e[n];if(!i.allowsMarkType(o))continue;let r=[],s=l=>{r.push(l);for(let h=0;h<l.edgeCount;h++){let{type:f,next:a}=l.edge(h);if(f==t||r.indexOf(a)<0&&s(a))return!0}};if(s(i.contentMatch))return!0}}function H(o,t){for(let e=0;e<t.length;e++)if(o.eq(t[e]))return t[e]}class g{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=M(e).createDocumentFragment());let i=n,r=[];return t.forEach(s=>{if(r.length||s.marks.length){let l=0,h=0;for(;l<r.length&&h<s.marks.length;){let f=s.marks[h];if(!this.marks[f.type.name]){h++;continue}if(!f.eq(r[l][0])||f.type.spec.spanning===!1)break;l++,h++}for(;l<r.length;)i=r.pop()[1];for(;h<s.marks.length;){let f=s.marks[h++],a=this.serializeMark(f,s.isInline,e);a&&(r.push([f,i]),i.appendChild(a.dom),i=a.contentDOM||a.dom)}}i.appendChild(this.serializeNodeInner(s,e))}),n}serializeNodeInner(t,e){let{dom:n,contentDOM:i}=g.renderSpec(M(e),this.nodes[t.type.name](t));if(i){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,i)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let i=t.marks.length-1;i>=0;i--){let r=this.serializeMark(t.marks[i],t.isInline,e);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(t,e,n={}){let i=this.marks[t.type.name];return i&&g.renderSpec(M(n),i(t,e))}static renderSpec(t,e,n=null){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],r=i.indexOf(" ");r>0&&(n=i.slice(0,r),i=i.slice(r+1));let s,l=n?t.createElementNS(n,i):t.createElement(i),h=e[1],f=1;if(h&&typeof h=="object"&&h.nodeType==null&&!Array.isArray(h)){f=2;for(let a in h)if(h[a]!=null){let p=a.indexOf(" ");p>0?l.setAttributeNS(a.slice(0,p),a.slice(p+1),h[a]):l.setAttribute(a,h[a])}}for(let a=f;a<e.length;a++){let p=e[a];if(p===0){if(a<e.length-1||a>f)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:F,contentDOM:z}=g.renderSpec(t,p,n);if(l.appendChild(F),z){if(s)throw new RangeError("Multiple content holes");s=z}}}return{dom:l,contentDOM:s}}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new g(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=P(t.nodes);return e.text||(e.text=n=>n.text),e}static marksFromSchema(t){return P(t.marks)}}function P(o){let t={};for(let e in o){let n=o[e].spec.toDOM;n&&(t[e]=n)}return t}function M(o){return o.document||window.document}export{T as D,c as F,u as M,Q as N,K as R,d as S,R as a,g as b};
